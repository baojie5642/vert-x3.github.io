<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<title>Apex</title>
<style>
@font-face { font-family: 'TitilliumText22LThin'; src: url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L001-webfont.eot"); src: url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L001-webfont.eot?#iefix") format("embedded-opentype"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L001-webfont.woff") format("woff"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L001-webfont.ttf") format("truetype"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L001-webfont.svg#TitilliumText22LThin") format("svg"); font-weight: normal; font-style: normal; }

@font-face { font-family: 'TitilliumText22LLight'; src: url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L002-webfont.eot"); src: url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L002-webfont.eot?#iefix") format("embedded-opentype"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L002-webfont.woff") format("woff"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L002-webfont.ttf") format("truetype"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L002-webfont.svg#TitilliumText22LLight") format("svg"); font-weight: normal; font-style: normal; }

@font-face { font-family: 'TitilliumText22LRegular'; src: url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L003-webfont.eot"); src: url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L003-webfont.eot?#iefix") format("embedded-opentype"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L003-webfont.woff") format("woff"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L003-webfont.ttf") format("truetype"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L003-webfont.svg#TitilliumText22LRegular") format("svg"); font-weight: normal; font-style: normal; }

@font-face { font-family: 'TitilliumText22LMedium'; src: url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L004-webfont.eot"); src: url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L004-webfont.eot?#iefix") format("embedded-opentype"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L004-webfont.woff") format("woff"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L004-webfont.ttf") format("truetype"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L004-webfont.svg#TitilliumText22LMedium") format("svg"); font-weight: normal; font-style: normal; }

@font-face { font-family: 'TitilliumText22LBold'; src: url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L005-webfont.eot"); src: url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L005-webfont.eot?#iefix") format("embedded-opentype"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L005-webfont.woff") format("woff"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L005-webfont.ttf") format("truetype"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L005-webfont.svg#TitilliumText22LBold") format("svg"); font-weight: normal; font-style: normal; }

@font-face { font-family: 'TitilliumText22LXBold'; src: url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L006-webfont.eot"); src: url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L006-webfont.eot?#iefix") format("embedded-opentype"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L006-webfont.woff") format("woff"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L006-webfont.ttf") format("truetype"), url("http://static.jboss.org/theme/fonts/titilliumtext/TitilliumText22L006-webfont.svg#TitilliumText22LXBold") format("svg"); font-weight: normal; font-style: normal; }

/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 15px; }

body { background: white; color: #656565; padding: 0; margin: 0; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #b2b2b2; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #336699; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #204060; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Source Sans Pro", "TitilliumText22LMedium", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; color: #656565; text-rendering: optimizeLegibility; margin-top: 1.5em; margin-bottom: 0.5em; line-height: 0.9125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #b2b2b2; line-height: 0; }

h1 { font-size: 1.975em; }

h2 { font-size: 1.525em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.3875em; }

h4 { font-size: 0.9375em; }

h5 { font-size: 1em; }

h6 { font-size: 0.85em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-weight: normal; color: #c7254e; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; }

ul, ol { margin-left: 0; }
ul.no-bullet, ol.no-bullet { margin-left: 0; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #656565; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #989898; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #989898; }

blockquote, blockquote p { line-height: 1.6; color: #b2b2b2; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.1; }
  h1 { font-size: 2.6em; }
  h2 { font-size: 2.15em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.7em; }
  h4 { font-size: 1.25em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: 0.875em; color: #656565; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: 0.875em; color: #656565; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.125em; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.1; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 0; background-color: #f9f2f4; -webkit-border-radius: 4px; border-radius: 4px; line-height: inherit; }

pre, pre > code { line-height: 1.6; color: #656565; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }

.keyseq { color: #989898; }

kbd { display: inline-block; color: #656565; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #4c4c4c; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: #656565; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #989898; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #b2b2b2; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #b2b2b2; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: #656565; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Source Sans Pro", "TitilliumText22LMedium", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #b2b2b2; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #656565; padding: 1.25em; }

#footer-text { color: #9a9a9a; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #656565; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #585858; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: #656565; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Source Sans Pro", "TitilliumText22LMedium", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #989898; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #b2b2b2; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: whitesmoke; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #dddddd; -webkit-border-radius: 4px; border-radius: 4px; word-wrap: break-word; padding: 0.625em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: whitesmoke; background-color: #656565; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.625em; -webkit-border-radius: 4px; border-radius: 4px; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #b2b2b2; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #b2b2b2; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #989898; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #b2b2b2; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #989898; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.125em; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #656565; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 0.25em; }

ul li ol { margin-left: 0; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1em; font-size: 0.85em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { width: 1em; position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #bfbfbf; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #656565; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: #656565; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 15px; }

body { -webkit-font-smoothing: subpixel-antialiased; }

#content { margin-top: 5em; }

.sect1 { margin-top: 5em; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>document.addEventListener('DOMContentLoaded', prettyPrint)</script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Apex</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_re_cap_on_vert_x_core_http_servers">Re-cap on Vert.x core HTTP servers</a></li>
<li><a href="#_basic_apex_concepts">Basic Apex concepts</a></li>
<li><a href="#_handling_requests_and_calling_the_next_handler">Handling requests and calling the next handler</a></li>
<li><a href="#_routing_by_exact_path">Routing by exact path</a></li>
<li><a href="#_routing_by_paths_that_begin_with_something">Routing by paths that begin with something</a></li>
<li><a href="#_capturing_path_parameters">Capturing path parameters</a></li>
<li><a href="#_routing_with_regular_expressions">Routing with regular expressions</a></li>
<li><a href="#_capturing_path_parameters_with_regular_expressions">Capturing path parameters with regular expressions</a></li>
<li><a href="#_routing_by_http_method">Routing by HTTP method</a></li>
<li><a href="#_route_order">Route order</a></li>
<li><a href="#_routing_based_on_mime_type_of_request">Routing based on MIME type of request</a></li>
<li><a href="#_routing_based_on_mime_types_acceptable_by_the_client">Routing based on MIME types acceptable by the client</a></li>
<li><a href="#_combining_routing_criteria">Combining routing criteria</a></li>
<li><a href="#_enabling_and_disabling_routes">Enabling and disabling routes</a></li>
<li><a href="#_context_data">Context data</a></li>
<li><a href="#_sub_routers">Sub-routers</a></li>
<li><a href="#_default_404_handling">Default 404 Handling</a></li>
<li><a href="#_error_handling">Error handling</a></li>
<li><a href="#_request_body_handling">Request body handling</a>
<ul class="sectlevel2">
<li><a href="#_getting_the_request_body">Getting the request body</a></li>
<li><a href="#_limiting_body_size">Limiting body size</a></li>
<li><a href="#_merging_form_attributes">Merging form attributes</a></li>
<li><a href="#_handling_file_uploads">Handling file uploads</a></li>
</ul>
</li>
<li><a href="#_handling_cookies">Handling cookies</a>
<ul class="sectlevel2">
<li><a href="#_manipulating_cookies">Manipulating cookies</a></li>
</ul>
</li>
<li><a href="#_handling_sessions">Handling sessions</a>
<ul class="sectlevel2">
<li><a href="#_session_stores">Session stores</a></li>
<li><a href="#_creating_the_session_handler">Creating the session handler</a></li>
<li><a href="#_using_the_session">Using the session</a></li>
<li><a href="#_session_timeout">Session timeout</a></li>
</ul>
</li>
<li><a href="#_authentication_authorisation">Authentication / authorisation</a>
<ul class="sectlevel2">
<li><a href="#_creating_an_auth_handler">Creating an auth handler</a></li>
<li><a href="#_handling_auth_in_your_application">Handling auth in your application</a></li>
<li><a href="#_http_basic_authentication">HTTP Basic Authentication</a></li>
<li><a href="#_redirect_auth_handler">Redirect auth handler</a></li>
<li><a href="#_configuring_required_roles_and_permissions">Configuring required roles and permissions</a></li>
<li><a href="#_oauth">OAuth</a></li>
</ul>
</li>
<li><a href="#_serving_static_resources">Serving static resources</a>
<ul class="sectlevel2">
<li><a href="#_configuring_caching">Configuring caching</a></li>
<li><a href="#_configuring_the_index_page">Configuring the index page</a></li>
<li><a href="#_changing_the_web_root">Changing the web root</a></li>
<li><a href="#_serving_hidden_files">Serving hidden files</a></li>
<li><a href="#_directory_listing">Directory listing</a></li>
</ul>
</li>
<li><a href="#_cors_handling">CORS handling</a></li>
<li><a href="#_templates">Templates</a>
<ul class="sectlevel2">
<li><a href="#_mvel_template_engine">MVEL template engine</a></li>
<li><a href="#_jade_template_engine">Jade template engine</a></li>
<li><a href="#_handlebars_template_engine">Handlebars template engine</a></li>
<li><a href="#_thymeleaf_template_engine">Thymeleaf template engine</a></li>
</ul>
</li>
<li><a href="#_error_handler">Error handler</a></li>
<li><a href="#_request_logger">Request logger</a></li>
<li><a href="#_serving_favicons">Serving favicons</a></li>
<li><a href="#_timeout_handler">Timeout handler</a></li>
<li><a href="#_response_time_handler">Response time handler</a></li>
<li><a href="#_sockjs">SockJS</a>
<ul class="sectlevel2">
<li><a href="#_sockjs_handler">SockJS handler</a></li>
<li><a href="#_handling_sockjs_sockets">Handling SockJS sockets</a></li>
<li><a href="#_the_client_side">The client side</a></li>
<li><a href="#_configuring_the_sockjs_handler">Configuring the SockJS handler</a></li>
</ul>
</li>
<li><a href="#_sockjs_event_bus_bridge">SockJS event bus bridge</a>
<ul class="sectlevel2">
<li><a href="#_securing_the_bridge">Securing the Bridge</a></li>
<li><a href="#_requiring_authorisation_for_messages">Requiring authorisation for messages</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Apex is a set of building blocks for building web applications with Vert.x.</p>
</div>
<div class="paragraph">
<p>Think of it as a Swiss Army Knife for building
modern, scalable, web apps.</p>
</div>
<div class="paragraph">
<p>Vert.x core provides a fairly low level set of functionality for handling HTTP, and for some applications
that will be sufficient.</p>
</div>
<div class="paragraph">
<p>Vert.x Apex builds on Vert.x core to provide a richer set of functionality for building real web applications, more
easily.</p>
</div>
<div class="paragraph">
<p>It&#8217;s the successor to <a href="http://pmlopes.github.io/yoke/">Yoke</a> in Vert.x 2.x, and takes inspiration from projects such
as <a href="http://expressjs.com/">Express</a> in the Node.js world and <a href="http://www.sinatrarb.com/">Sinatra</a> in the Ruby world.</p>
</div>
<div class="paragraph">
<p>Apex is designed to be powerful, un-opionated and fully embeddable. You just use the parts you want and nothing more.
Apex is not a container.</p>
</div>
<div class="paragraph">
<p>You can use Apex to create classic server-side web applications, RESTful web applications, 'real-time' (server push)
web applications, or any other kind of web application you can think of. Apex doesn&#8217;t care. It&#8217;s up to you to chose
the type of app you prefer, not Apex.</p>
</div>
<div class="paragraph">
<p>Apex is a great fit for writing <strong>RESTful HTTP micro-services</strong>, but we don&#8217;t <strong>force</strong> you to write apps like that.</p>
</div>
<div class="paragraph">
<p>Some of the key features of Apex include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Routing (based on method, path, etc)</p>
</li>
<li>
<p>Regular expression pattern matching for paths</p>
</li>
<li>
<p>Extraction of parameters from paths</p>
</li>
<li>
<p>Content negotiation</p>
</li>
<li>
<p>Request body handling</p>
</li>
<li>
<p>Body size limits</p>
</li>
<li>
<p>Cookie parsing and handling</p>
</li>
<li>
<p>Multipart forms</p>
</li>
<li>
<p>Multipart file uploads</p>
</li>
<li>
<p>Sub routers</p>
</li>
<li>
<p>Session support - both local (for sticky sessions) and clustered (for non sticky)</p>
</li>
<li>
<p>CORS (Cross Origin Resource Sharing) support</p>
</li>
<li>
<p>Error page handler</p>
</li>
<li>
<p>Basic Authentication</p>
</li>
<li>
<p>Redirect based authentication</p>
</li>
<li>
<p>User/role/permission authorisation</p>
</li>
<li>
<p>Favicon handling</p>
</li>
<li>
<p>Template support for server side rendering, including support for the following template engines out of the box:</p>
<div class="ulist">
<ul>
<li>
<p>Handlebars</p>
</li>
<li>
<p>Jade,</p>
</li>
<li>
<p>MVEL</p>
</li>
<li>
<p>Thymeleaf</p>
</li>
</ul>
</div>
</li>
<li>
<p>Response time handler</p>
</li>
<li>
<p>Static file serving, including caching logic and directory listing.</p>
</li>
<li>
<p>Request timeout support</p>
</li>
<li>
<p>SockJS support</p>
</li>
<li>
<p>Event-bus bridge</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Most features in Apex are implemented as handlers so you can always write your own. We envisage many more being written
over time.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll discuss all these features in this manual.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_re_cap_on_vert_x_core_http_servers">Re-cap on Vert.x core HTTP servers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apex uses and exposes the API from Vert.x core, so it&#8217;s well worth getting familiar with the basic concepts of writing
HTTP servers using Vert.x core, if you&#8217;re not already.</p>
</div>
<div class="paragraph">
<p>The Vert.x core HTTP documentation goes into a lot of detail on this.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a hello world web server written using Vert.x core. At this point there is no Apex involved:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">var server = vertx.createHttpServer();

server.requestHandler(function (request) {

  // This handler gets called for each request that arrives on the server
  var response = request.response();
  response.putHeader("content-type", "text/plain");

  // Write to the response and end it
  response.end("Hello World!");
});

server.listen(8080);</code></pre>
</div>
</div>
<div class="paragraph">
<p>We create an HTTP server instance, and we set a request handler on it. The request handler will be called whenever
a request arrives on the server.</p>
</div>
<div class="paragraph">
<p>When that happens we are just going to set the content type to <code>text/plain</code>, and write <code>Hello World!</code> and end the
response.</p>
</div>
<div class="paragraph">
<p>We then tell the server to listen at port <code>8080</code> (default host is <code>localhost</code>).</p>
</div>
<div class="paragraph">
<p>You can run this, and point your browser at <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code> to verify that it works as expected.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_apex_concepts">Basic Apex concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here&#8217;s the 10000 foot view:</p>
</div>
<div class="paragraph">
<p>A <code><a href="jsdoc/router-Router.html">Router</a></code> is one of the core concepts of Apex. It&#8217;s an object which maintains zero or more
<code><a href="jsdoc/route-Route.html">Routes</a></code> .</p>
</div>
<div class="paragraph">
<p>A router takes an HTTP request and finds the first matching route for that request, and passes the request to that route.</p>
</div>
<div class="paragraph">
<p>The route can have a <em>handler</em> associated with it, which then receives the request. You then <em>do something</em> with the
request, and then, either end it or pass it to the next matching handler.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a simple router example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var Router = require("vertx-apex-js/router");
var server = vertx.createHttpServer();

var router = Router.router(vertx);

router.route().handler(function (routingContext) {

  // This handler will be called for every request
  var response = routingContext.response();
  response.putHeader("content-type", "text/plain");

  // Write to the response and end it
  response.end("Hello World from Apex!");
});

server.requestHandler(router.accept).listen(8080);</code></pre>
</div>
</div>
<div class="paragraph">
<p>It basically does the same thing as the Vert.x Core HTTP server hello world example from the previous section,
but this time using Apex.</p>
</div>
<div class="paragraph">
<p>We create an HTTP server as before, then we create a router. Once we&#8217;ve done that we create a simple route with
no matching criteria so it will match <em>all</em> requests that arrive on the server.</p>
</div>
<div class="paragraph">
<p>We then specify a handler for that route. That handler will be called for all requests that arrive on the server.</p>
</div>
<div class="paragraph">
<p>The object that gets passed into the handler is a <code><a href="jsdoc/routing_context-RoutingContext.html">RoutingContext</a></code> - this contains
the standard Vert.x <code><a href="../../vertx-core/js/jsdoc/http_server_request-HttpServerRequest.html">HttpServerRequest</a></code> and <code><a href="../../vertx-core/js/jsdoc/http_server_response-HttpServerResponse.html">HttpServerResponse</a></code>
but also various other useful stuff that makes working with Apex simpler.</p>
</div>
<div class="paragraph">
<p>For every request that is routed there is a unique routing context instance, and the same instance is passed to
all handlers for that request.</p>
</div>
<div class="paragraph">
<p>Once we&#8217;ve set up the handler, we set the request handler of the HTTP server to pass all incoming requests
to <code><a href="jsdoc/router-Router.html#accept">accept</a></code>.</p>
</div>
<div class="paragraph">
<p>So, that&#8217;s the basics. Now we&#8217;ll look at things in more detail:</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_requests_and_calling_the_next_handler">Handling requests and calling the next handler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When Apex decides to route a request to a matching route, it calls the handler of the route passing in an instance
of <code><a href="jsdoc/routing_context-RoutingContext.html">RoutingContext</a></code>.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t end the response in your handler, you should call <code><a href="jsdoc/routing_context-RoutingContext.html#next">next</a></code> so another
matching route can handle the request (if any).</p>
</div>
<div class="paragraph">
<p>You don&#8217;t have to call <code><a href="jsdoc/routing_context-RoutingContext.html#next">next</a></code> before the handler has finished executing.
You can do this some time later, if you want:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var route1 = router.route("/some/path/").handler(function (routingContext) {

  var response = routingContext.response();
  response.write("route1\n");

  // Call the next matching route after a 5 second delay
  routingContext.vertx().setTimer(5000, function (tid) {
    routingContext.next()});
});

var route2 = router.route("/some/path/").handler(function (routingContext) {

  var response = routingContext.response();
  response.write("route2\n");

  // Call the next matching route after a 5 second delay
  routingContext.vertx().setTimer(5000, function (tid) {
    routingContext.next()});
});

var route3 = router.route("/some/path/").handler(function (routingContext) {

  var response = routingContext.response();
  response.write("route3");

  // Now end the response
  routingContext.response().end();
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example <code>route1</code> is written to the response, then 5 seconds later <code>route2</code> is written to the response,
then 5 seconds later <code>route3</code> is written to the response and the response is ended.</p>
</div>
<div class="paragraph">
<p>Note, all this happens without any thread blocking.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_routing_by_exact_path">Routing by exact path</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A route can be set-up to match the path from the request URI. In this case it will match any request which has a path
that&#8217;s the same as the specified path.</p>
</div>
<div class="paragraph">
<p>In the following example the handler will be called for a request <code>/some/path/</code>. We also ignore trailing slashes
so it will be called for paths <code>/some/path</code> and <code>/some/path//</code> too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var route = router.route().path("/some/path/");

route.handler(function (routingContext) {
  // This handler will be called for the following request paths:

  // `/some/path`
  // `/some/path/`
  // `/some/path//`
  //
  // but not:
  // `/some/path/subdir`
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_routing_by_paths_that_begin_with_something">Routing by paths that begin with something</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Often you want to route all requests that begin with a certain path. You could use a regex to do this, but a simply
way is to use an asterisk <code>*</code> at the end of the path when declaring the route path.</p>
</div>
<div class="paragraph">
<p>In the following example the handler will be called for any request with a URI path that starts with
<code>/some/path/</code>.</p>
</div>
<div class="paragraph">
<p>For example <code>/some/path/foo.html</code> and <code>/some/path/otherdir/blah.css</code> would both match.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var route = router.route().path("/some/path/*");

route.handler(function (routingContext) {
  // This handler will be called for any path that starts with
  // `/some/path/`, e.g.

  // `/some/path`
  // `/some/path/`
  // `/some/path/subdir`
  // `/some/path/subdir/blah.html`
  //
  // but not:
  // `/some/bath`
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>With any path it can also be specified when creating the route:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var route = router.route("/some/path/*");

route.handler(function (routingContext) {
  // This handler will be called same as previous example
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_capturing_path_parameters">Capturing path parameters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s possible to match paths using placeholders for parameters which are then available in the request
<code><a href="../../vertx-core/js/jsdoc/http_server_request-HttpServerRequest.html#params">params</a></code>.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var route = router.route('POST', "/catalogue/products/:productype/:productid/");

route.handler(function (routingContext) {

  var productType = routingContext.request().getParam("producttype");
  var productID = routingContext.request().getParam("productid");

  // Do something with them...
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The placeholders consist of <code>:</code> followed by the parameter name. Parameter names consist of any alphabetic character,
numeric character or underscore.</p>
</div>
<div class="paragraph">
<p>In the above example, if a POST request is made to path: <code>/catalogue/products/tools/drill123/</code> then the route will match
and <code>productType</code> will receive the value <code>tools</code> and productID will receive the value <code>drill123</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_routing_with_regular_expressions">Routing with regular expressions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Regular expressions can also be used to match URI paths in routes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">// Matches any path ending with 'foo'
var route = router.route().pathRegex(".*foo");

route.handler(function (routingContext) {

  // This handler will be called for:

  // /some/path/foo
  // /foo
  // /foo/bar/wibble/foo
  // /foo/bar

  // But not:
  // /bar/wibble
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively the regex can be specified when creating the route:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var route = router.routeWithRegex(".*foo");

route.handler(function (routingContext) {

  // This handler will be called same as previous example

});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_capturing_path_parameters_with_regular_expressions">Capturing path parameters with regular expressions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can also capture path parameters when using regular expressions, here&#8217;s an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var route = router.routeWithRegex(".*foo");

// This regular expression matches paths that start with something like:
// "/foo/bar" - where the "foo" is captured into param0 and the "bar" is captured into
// param1
route.pathRegex("\\/([^\\/]+)\\/([^\\/]+)").handler(function (routingContext) {

  var productType = routingContext.request().getParam("param0");
  var productID = routingContext.request().getParam("param1");

  // Do something with them...
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, if a request is made to path: <code>/tools/drill123/</code> then the route will match
and <code>productType</code> will receive the value <code>tools</code> and productID will receive the value <code>drill123</code>.</p>
</div>
<div class="paragraph">
<p>Captures are denoted in regular expressions with capture groups (i.e. surrounding the capture with round brackets)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_routing_by_http_method">Routing by HTTP method</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default a route will match all HTTP methods.</p>
</div>
<div class="paragraph">
<p>If you want a route to only match for a specific HTTP method you can use <code><a href="jsdoc/route-Route.html#method">method</a></code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var route = router.route().method('POST');

route.handler(function (routingContext) {

  // This handler will be called for any POST request

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can specify this with a path when creating the route:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var route = router.route('POST', "/some/path/");

route.handler(function (routingContext) {

  // This handler will be called for any POST request to a URI path starting with /some/path/

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to route for a specific HTTP method you can also use the methods such as <code><a href="jsdoc/router-Router.html#get">get</a></code>,
<code><a href="jsdoc/router-Router.html#post">post</a></code> and <code><a href="jsdoc/router-Router.html#put">put</a></code> named after the HTTP
method name. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">router.get().handler(function (routingContext) {

  // Will be called for any GET request

});

router.get("/some/path/").handler(function (routingContext) {

  // Will be called for any GET request to a path
  // starting with /some/path

});

router.getWithRegex(".*foo").handler(function (routingContext) {

  // Will be called for any GET request to a path
  // ending with `foo`

});

// There are also equivalents to the above for PUT, POST, DELETE, HEAD and OPTIONS</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to specify a route will match for more than HTTP method you can call <code><a href="jsdoc/route-Route.html#method">method</a></code>
multiple times:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var route = router.route().method('POST').method('PUT');

route.handler(function (routingContext) {

  // This handler will be called for any POST or PUT request

});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_route_order">Route order</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default routes are matched in the order they are added to the router.</p>
</div>
<div class="paragraph">
<p>When a request arrives the router will step through each route and check if it matches, if it matches then
the handler for that route will be called.</p>
</div>
<div class="paragraph">
<p>If the handler subsequently calls <code><a href="jsdoc/routing_context-RoutingContext.html#next">next</a></code> the handler for the next
matching route (if any) will be called. And so on.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example to illustrate this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var route1 = router.route("/some/path/").handler(function (routingContext) {

  var response = routingContext.response();
  response.write("route1\n");

  // Now call the next matching route
  routingContext.next();
});

var route2 = router.route("/some/path/").handler(function (routingContext) {

  var response = routingContext.response();
  response.write("route2\n");

  // Now call the next matching route
  routingContext.next();
});

var route3 = router.route("/some/path/").handler(function (routingContext) {

  var response = routingContext.response();
  response.write("route3");

  // Now end the response
  routingContext.response().end();
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the response will contain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>route1
route2
route3</pre>
</div>
</div>
<div class="paragraph">
<p>As the routes have been called in that order for any request that starts with <code>/some/path</code>.</p>
</div>
<div class="paragraph">
<p>If you want to override the default ordering for routes, you can do so using <code><a href="jsdoc/route-Route.html#order">order</a></code>,
specifying an integer value.</p>
</div>
<div class="paragraph">
<p>Routes are assigned an order at creation time corresponding to the order in which they were added to the router, with
the first route numbered <code>0</code>, the second route numbered <code>1</code>, and so on.</p>
</div>
<div class="paragraph">
<p>By specifying an order for the route you can override the default ordering. Order can also be negative, e.g. if you
want to ensure a route is evaluated before route number <code>0</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s change the ordering of route2 so it runs before route1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var route1 = router.route("/some/path/").handler(function (routingContext) {

  var response = routingContext.response();
  response.write("route1\n");

  // Now call the next matching route
  routingContext.next();
});

var route2 = router.route("/some/path/").handler(function (routingContext) {

  var response = routingContext.response();
  response.write("route2\n");

  // Now call the next matching route
  routingContext.next();
});

var route3 = router.route("/some/path/").handler(function (routingContext) {

  var response = routingContext.response();
  response.write("route3");

  // Now end the response
  routingContext.response().end();
});

// Change the order of route2 so it runs before route1
route2.order(-1);</code></pre>
</div>
</div>
<div class="paragraph">
<p>then the response will now contain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>route2
route1
route3</pre>
</div>
</div>
<div class="paragraph">
<p>If two matching routes have the same value of order, then they will be called in the order they were added.</p>
</div>
<div class="paragraph">
<p>You can also specify that a route is handled last, with <code><a href="jsdoc/route-Route.html#last">last</a></code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_routing_based_on_mime_type_of_request">Routing based on MIME type of request</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can specify that a route will match against matching request MIME types using <code><a href="jsdoc/route-Route.html#consumes">consumes</a></code>.</p>
</div>
<div class="paragraph">
<p>In this case, the request will contain a <code>content-type</code> header specifying the MIME type of the request body.
This will be matched against the value specified in <code><a href="jsdoc/route-Route.html#consumes">consumes</a></code>.</p>
</div>
<div class="paragraph">
<p>Basically, <code>consumes</code> is describing which MIME types the handler can <em>consume</em>.</p>
</div>
<div class="paragraph">
<p>Matching can be done on exact MIME type matches:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">// Exact match
router.route().consumes("text/html").handler(function (routingContext) {

  // This handler will be called for any request with
  // content-type header set to `text/html`

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple exact matches can also be specified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">// Multiple exact matches
router.route().consumes("text/html").consumes("text/plain").handler(function (routingContext) {

  // This handler will be called for any request with
  // content-type header set to `text/html` or `text/plain`.

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Matching on wildcards for the sub-type is supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">// Sub-type wildcard match
router.route().consumes("text/*").handler(function (routingContext) {

  // This handler will be called for any request with top level type `text`
  // e.g. content-type header set to `text/html` or `text/plain` will both match

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>And you can also match on the top level type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">// Top level type wildcard match
router.route().consumes("*/json").handler(function (routingContext) {

  // This handler will be called for any request with sub-type json
  // e.g. content-type header set to `text/json` or `application/json` will both match

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t specify a <code>/</code> in the consumers, it will assume you meant the sub-type.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_routing_based_on_mime_types_acceptable_by_the_client">Routing based on MIME types acceptable by the client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The HTTP <code>accept</code> header is used to signify which MIME types of the response are acceptable to the client.</p>
</div>
<div class="paragraph">
<p>An <code>accept</code> header can have multiple MIME types separated by &#8216;,&#8217;.</p>
</div>
<div class="paragraph">
<p>MIME types can also have a <code>q</code> value appended to them* which signifies a weighting to apply if more than one
response MIME type is available matching the accept header. The q value is a number between 0 and 1.0.
If omitted it defaults to 1.0.</p>
</div>
<div class="paragraph">
<p>For example, the following <code>accept</code> header signifies the client will accept a MIME type of only <code>text/plain</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Accept: text/plain</pre>
</div>
</div>
<div class="paragraph">
<p>With the following the client will accept <code>text/plain</code> or <code>text/html</code> with no preference.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Accept: text/plain, text/html</pre>
</div>
</div>
<div class="paragraph">
<p>With the following the client will accept <code>text/plain</code> or <code>text/html</code> but prefers <code>text/html</code> as it has a higher
<code>q</code> value (the default value is q=1.0)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Accept: text/plain; q=0.9, text/html</pre>
</div>
</div>
<div class="paragraph">
<p>If the server can provide both text/plain and text/html it should provide the text/html in this case.</p>
</div>
<div class="paragraph">
<p>By using <code><a href="jsdoc/route-Route.html#produces">produces</a></code> you define which MIME type(s) the route produces, e.g. the
following handler produces a response with MIME type <code>application/json</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">router.route().produces("application/json").handler(function (routingContext) {

  var response = routingContext.response();
  response.putHeader("content-type", "application/json");
  response.write(someJSON).end();

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the route will match with any request with an <code>accept</code> header that matches <code>application/json</code>.</p>
</div>
<div class="paragraph">
<p>Here are some examples of <code>accept</code> headers that will match:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Accept: application/json
Accept: application/*
Accept: application/json, text/html
Accept: application/json;q=0.7, text/html;q=0.8, text/plain</pre>
</div>
</div>
<div class="paragraph">
<p>You can also mark your route as producing more than one MIME type. If this is the case, then you use
<code><a href="jsdoc/routing_context-RoutingContext.html#getAcceptableContentType">getAcceptableContentType</a></code> to find out the actual MIME type that
was accepted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">// This route can produce two different MIME types
router.route().produces("application/json").produces("text/html").handler(function (routingContext) {

  var response = routingContext.response();

  // Get the actual MIME type acceptable
  var acceptableContentType = routingContext.getAcceptableContentType();

  response.putHeader("content-type", acceptableContentType);
  response.write(whatever).end();
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, if you sent a request with the following <code>accept</code> header:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Accept: application/json; q=0.7, text/html</pre>
</div>
</div>
<div class="paragraph">
<p>Then the route would match and <code>acceptableContentType</code> would contain <code>text/html</code> as both are
acceptable but that has a higher <code>q</code> value.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_combining_routing_criteria">Combining routing criteria</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can combine all the above routing criteria in many different ways, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var route = router.route('PUT', "myapi/orders").consumes("application/json").produces("application/json");

route.handler(function (routingContext) {

  // This would be match for any PUT method to paths starting with "myapi/orders" with a
  // content-type of "application/json"
  // and an accept header matching "application/json"

});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_and_disabling_routes">Enabling and disabling routes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can disable a route with <code><a href="jsdoc/route-Route.html#disable">disable</a></code>. A disabled route will be ignored when matching.</p>
</div>
<div class="paragraph">
<p>You can re-enable a disabled route with <code><a href="jsdoc/route-Route.html#enable">enable</a></code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_context_data">Context data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use the context data in the <code><a href="jsdoc/routing_context-RoutingContext.html">RoutingContext</a></code> to maintain any data that you
want to share between handlers for the lifetime of the request.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example where one handler sets some data in the context data and a subsequent handler retrieves it:</p>
</div>
<div class="paragraph">
<p>You can use the <code><a href="jsdoc/routing_context-RoutingContext.html#put">put</a></code> to put any object, and
<code><a href="jsdoc/routing_context-RoutingContext.html#get">get</a></code> to retrieve any object from the context data.</p>
</div>
<div class="paragraph">
<p>A request sent to path <code>/some/path/other</code> will match both routes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">router.get("/some/path").handler(function (routingContext) {

  routingContext.put("foo", "bar");
  routingContext.next();

});

router.get("/some/path/other").handler(function (routingContext) {

  var bar = routingContext.get("foo");
  // Do something with bar
  routingContext.response().end();

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can access the entire context data map with <code><a href="jsdoc/routing_context-RoutingContext.html#data">data</a></code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sub_routers">Sub-routers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes if you have a lot of handlers it can make sense to split them up into multiple routers. This is also useful
if you want to reuse a set of handlers in a different application, rooted at a different path root.</p>
</div>
<div class="paragraph">
<p>To do this you can mount a router at a <em>mount point</em> in another router. The router that is mounted is called a
<em>sub-router</em>. Sub routers can mount other sub routers so you can have several levels of sub-routers if you like.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at a simple example of a sub-router mounted with another router.</p>
</div>
<div class="paragraph">
<p>This sub-router will maintain the set of handlers that corresponds to a simple fictional REST API. We will mount that on another
router. The full implementation of the REST API is not shown.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the sub-router:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var Router = require("vertx-apex-js/router");

var restAPI = Router.router(vertx);

restAPI.get("/products/:productID").handler(function (rc) {

  // TODO Handle the lookup of the product....
  rc.response().write(productJSON);

});

restAPI.put("/products/:productID").handler(function (rc) {

  // TODO Add a new product...
  rc.response().end();

});

restAPI.delete("/products/:productID").handler(function (rc) {

  // TODO delete the product...
  rc.response().end();

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>If this router was used as a top level router, then GET/PUT/DELETE requests to urls like <code>/products/product1234</code>
would invoke the  API.</p>
</div>
<div class="paragraph">
<p>However, let&#8217;s say we already have a web-site as described by another router:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var Router = require("vertx-apex-js/router");
var mainRouter = Router.router(vertx);

// Handle static resources
mainRouter.route("/static/*").handler(myStaticHandler);

mainRouter.route(".*\\.templ").handler(myTemplateHandler);</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now mount the sub router on the main router, against a mount point, in this case <code>/productsAPI</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">mainRouter.mountSubRouter("/productsAPI", restAPI);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This means the REST API is now accessible via paths like: <code>/productsAPI/products/product1234</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_default_404_handling">Default 404 Handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If no routes match for any particular request, Apex will signal a 404 error.</p>
</div>
<div class="paragraph">
<p>This can then be handled by your own error handler, or perhaps the augmented error handler that we supply to use,
or if no error handler is provided Apex will send back a basic 404 (Not Found) response.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_error_handling">Error handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As well as setting handlers to handle requests you can also set handlers to handle failures in routing.</p>
</div>
<div class="paragraph">
<p>Failure handlers are used with the exact same route matching criteria that you use with normal handlers.</p>
</div>
<div class="paragraph">
<p>For example you can provide a failure handler that will only handle failures on certain paths, or for certain HTTP methods.</p>
</div>
<div class="paragraph">
<p>This allows you to set different failure handlers for different parts of your application.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example failure handler that will only be called for failure that occur when routing to GET requests
to paths that start with <code>/somepath/</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var route = router.get("/somepath/*");

route.failureHandler(function (frc) {

  // This will be called for failures that occur
  // when routing requests to paths starting with
  // '/somepath/'

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Failure routing will occur if a handler throws an exception, or if a handler calls
<code><a href="jsdoc/routing_context-RoutingContext.html#fail">fail</a></code> specifying an HTTP status code to deliberately signal a failure.</p>
</div>
<div class="paragraph">
<p>If an exception is caught from a handler this will result in a failure with status code <code>500</code> being signalled.</p>
</div>
<div class="paragraph">
<p>When handling the failure, the failure handler is passed the routing context which also allows the failure or failure code
to be retrieved so the failure handler can use that to generate a failure response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var route1 = router.get("/somepath/path1/");

route1.handler(function (routingContext) {

  // Let's say this throws a RuntimeException
  throw "something happened!";

});

var route2 = router.get("/somepath/path2");

route2.handler(function (routingContext) {

  // This one deliberately fails the request passing in the status code
  // E.g. 403 - Forbidden
  routingContext.fail(403);

});

// Define a failure handler
// This will get called for any failures in the above handlers
var route3 = router.get("/somepath/*");

route3.failureHandler(function (failureRoutingContext) {

  var statusCode = failureRoutingContext.statusCode();

  // Status code will be 500 for the RuntimeException or 403 for the other failure
  var response = failureRoutingContext.response();
  response.setStatusCode(statusCode).end("Sorry! Not today");

});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_request_body_handling">Request body handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code><a href="jsdoc/body_handler-BodyHandler.html">BodyHandler</a></code> allows you to retrieve request bodies, limit body sizes and handle
file uploads.</p>
</div>
<div class="paragraph">
<p>You should make sure a body handler is on a matching route for any requests that require this functionality.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var BodyHandler = require("vertx-apex-js/body_handler");

// This body handler will be called for all routes
router.route().handler(BodyHandler.create().handle);</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_getting_the_request_body">Getting the request body</h3>
<div class="paragraph">
<p>If you know the request body is JSON, then you can use <code><a href="jsdoc/routing_context-RoutingContext.html#getBodyAsJson">getBodyAsJson</a></code>,
if you know it&#8217;s a string you can use <code><a href="jsdoc/routing_context-RoutingContext.html#getBodyAsString">getBodyAsString</a></code>, or to
retrieve it as a buffer use <code><a href="jsdoc/routing_context-RoutingContext.html#getBody">getBody</a></code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_limiting_body_size">Limiting body size</h3>
<div class="paragraph">
<p>To limit the size of a request body, create the body handler then use <code><a href="jsdoc/body_handler-BodyHandler.html#setBodyLimit">setBodyLimit</a></code>
to specifying the maximum body size, in bytes. This is useful to avoid running out of memory with very large bodies.</p>
</div>
<div class="paragraph">
<p>If an attempt to send a body greater than the maximum size is made, an HTTP status code of 413 - <code>Request Entity Too Large</code>,
will be sent.</p>
</div>
<div class="paragraph">
<p>There is no body limit by default.</p>
</div>
</div>
<div class="sect2">
<h3 id="_merging_form_attributes">Merging form attributes</h3>
<div class="paragraph">
<p>By default, the body handler will merge any form attributes into the request parameters. If you don&#8217;t want this behaviour
you can use disable it with <code><a href="jsdoc/body_handler-BodyHandler.html#setMergeFormAttributes">setMergeFormAttributes</a></code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_handling_file_uploads">Handling file uploads</h3>
<div class="paragraph">
<p>Body handler is also used to handle multi-part file uploads.</p>
</div>
<div class="paragraph">
<p>If a body handler is on a matching route for the request, any file uploads will be automatically streamed to the
uploads directory, which is <code>file-uploads</code> by default.</p>
</div>
<div class="paragraph">
<p>Each file will be given an automatically generated file name, and the file uploads will be available on the routing
context with <code><a href="jsdoc/routing_context-RoutingContext.html#fileUploads">fileUploads</a></code>.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var BodyHandler = require("vertx-apex-js/body_handler");

router.route().handler(BodyHandler.create().handle);

router.post("/some/path/uploads").handler(function (routingContext) {

  var uploads = routingContext.fileUploads();
  // Do something with uploads....

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each file upload is described by a <code><a href="jsdoc/file_upload-FileUpload.html">FileUpload</a></code> instance, which allows various properties
such as the name, file-name and size to be accessed.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_cookies">Handling cookies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apex has cookies support using the <code><a href="jsdoc/cookie_handler-CookieHandler.html">CookieHandler</a></code>.</p>
</div>
<div class="paragraph">
<p>You should make sure a cookie handler is on a matching route for any requests that require this functionality.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var CookieHandler = require("vertx-apex-js/cookie_handler");

// This cookie handler will be called for all routes
router.route().handler(CookieHandler.create().handle);</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_manipulating_cookies">Manipulating cookies</h3>
<div class="paragraph">
<p>You use <code><a href="jsdoc/routing_context-RoutingContext.html#getCookie">getCookie</a></code> to retrieve
a cookie by name, or use <code><a href="jsdoc/routing_context-RoutingContext.html#cookies">cookies</a></code> to retrieve the entire set.</p>
</div>
<div class="paragraph">
<p>To remove a cookie, use <code><a href="jsdoc/routing_context-RoutingContext.html#removeCookie">removeCookie</a></code>.</p>
</div>
<div class="paragraph">
<p>To add a cookie use <code><a href="jsdoc/routing_context-RoutingContext.html#addCookie">addCookie</a></code>.</p>
</div>
<div class="paragraph">
<p>The set of cookies will be written back in the response automatically when the response headers are written so the
browser can store them.</p>
</div>
<div class="paragraph">
<p>Cookies are described by instances of <code><a href="jsdoc/cookie-Cookie.html">Cookie</a></code>. This allows you to retrieve the name,
value, domain, path and other normal cookie properties.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of querying and adding cookies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var CookieHandler = require("vertx-apex-js/cookie_handler");
var Cookie = require("vertx-apex-js/cookie");

// This cookie handler will be called for all routes
router.route().handler(CookieHandler.create().handle);

router.route("some/path/").handler(function (routingContext) {

  var someCookie = routingContext.getCookie("mycookie");
  var cookieValue = someCookie.getValue();

  // Do something with cookie...

  // Add a cookie - this will get written back in the response automatically
  routingContext.addCookie(Cookie.cookie("othercookie", "somevalue"));
});</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_sessions">Handling sessions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apex provides out of the box support for sessions.</p>
</div>
<div class="paragraph">
<p>Sessions last between HTTP requests for the length of a browser session and give you a place where you can add
session-scope information, such as a shopping basket.</p>
</div>
<div class="paragraph">
<p>Apex uses session cookies to identify a session. The session cookie is temporary and will be deleted by your browser
when it&#8217;s closed.</p>
</div>
<div class="paragraph">
<p>We don&#8217;t put the actual data of your session in the session cookie - the cookie simply uses an identifier to look-up
the actual session on the server. The identifier is a random UUID generated using a secure random, so it should
be effectively unguessable.</p>
</div>
<div class="paragraph">
<p>Cookies are passed across the wire in HTTP requests and responses so it&#8217;s always wise to make sure you are using
HTTPS when sessions are being used. Vert.x will warn you if you attempt to use sessions over straight HTTP.</p>
</div>
<div class="paragraph">
<p>To enable sessions in your application you must have a <code><a href="jsdoc/session_handler-SessionHandler.html">SessionHandler</a></code>
on a matching route before your application logic.</p>
</div>
<div class="paragraph">
<p>The session handler handles the creation of session cookies and the lookup of the session so you don&#8217;t have to do
that yourself.</p>
</div>
<div class="sect2">
<h3 id="_session_stores">Session stores</h3>
<div class="paragraph">
<p>To create a session handler you need to have a session store instance. The session store is the object that
holds the actual sessions for your application.</p>
</div>
<div class="paragraph">
<p>Apex comes with two session store implementations out of the box, and you can also write your own if you prefer.</p>
</div>
<div class="sect3">
<h4 id="_local_session_store">Local session store</h4>
<div class="paragraph">
<p>With this store, sessions are stored locally in memory and only available in this instance.</p>
</div>
<div class="paragraph">
<p>This store is appropriate if you have just a single Vert.x instance of you are using sticky sessions in your application
and have configured your load balancer to always route HTTP requests to the same Vert.x instance.</p>
</div>
<div class="paragraph">
<p>If you can&#8217;t ensure your requests will all terminate on the same server then don&#8217;t use this store as your
requests might end up on a server which doesn&#8217;t know about your session.</p>
</div>
<div class="paragraph">
<p>Local session stores are implemented by using a shared local map, and have a reaper which clears out expired sessions.</p>
</div>
<div class="paragraph">
<p>The reaper period can be configured with
<code><a href="jsdoc/local_session_store-LocalSessionStore.html#create">LocalSessionStore.create</a></code>.</p>
</div>
<div class="paragraph">
<p>Here are some examples of creating a <code><a href="jsdoc/local_session_store-LocalSessionStore.html">LocalSessionStore</a></code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var LocalSessionStore = require("vertx-apex-js/local_session_store");

// Create a local session store using defaults
var store1 = LocalSessionStore.create(vertx);

// Create a local session store specifying the local shared map name to use
// This might be useful if you have more than one application in the same
// Vert.x instance and want to use different maps for different applications
var store2 = LocalSessionStore.create(vertx, "myapp3.sessionmap");

// Create a local session store specifying the local shared map name to use and
// setting the reaper period for expired sessions to 10 seconds
var store3 = LocalSessionStore.create(vertx, "myapp3.sessionmap", 10000);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_clustered_session_store">Clustered session store</h4>
<div class="paragraph">
<p>With this store, sessions are stored in a distributed map which is accessible across the Vert.x cluster.</p>
</div>
<div class="paragraph">
<p>This store is appropriate if you&#8217;re <em>not</em> using sticky sessions, i.e. your load balancer is distributing different
requests from the same browser to different servers.</p>
</div>
<div class="paragraph">
<p>Your session is accessible from any node in the cluster using this store.</p>
</div>
<div class="paragraph">
<p>To you use a clustered session store you should make sure your Vert.x instance is clustered.</p>
</div>
<div class="paragraph">
<p>Here are some examples of creating a <code><a href="jsdoc/clustered_session_store-ClusteredSessionStore.html">ClusteredSessionStore</a></code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var Vertx = require("vertx-js/vertx");
var ClusteredSessionStore = require("vertx-apex-js/clustered_session_store");

// a clustered Vert.x
Vertx.clusteredVertx({
  "clustered" : true
}, function (res, res_err) {

  var vertx = res;

  // Create a clustered session store using defaults
  var store1 = ClusteredSessionStore.create(vertx);

  // Create a clustered session store specifying the distributed map name to use
  // This might be useful if you have more than one application in the cluster
  // and want to use different maps for different applications
  var store2 = ClusteredSessionStore.create(vertx, "myclusteredapp3.sessionmap");
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_the_session_handler">Creating the session handler</h3>
<div class="paragraph">
<p>Once you&#8217;ve created a session store you can create a session handler, and add it to a route. You should make sure
your session handler is routed to before your application handlers.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll also need to include a <code><a href="jsdoc/cookie_handler-CookieHandler.html">CookieHandler</a></code> as the session handler uses cookies to
lookup the session. The cookie handler should be before the session handler when routing.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var Router = require("vertx-apex-js/router");
var CookieHandler = require("vertx-apex-js/cookie_handler");
var ClusteredSessionStore = require("vertx-apex-js/clustered_session_store");
var SessionHandler = require("vertx-apex-js/session_handler");

var router = Router.router(vertx);

// We need a cookie handler first
router.route().handler(CookieHandler.create().handle);

// Create a clustered session store using defaults
var store = ClusteredSessionStore.create(vertx);

var sessionHandler = SessionHandler.create(store);

// Make sure all requests are routed through the session handler too
router.route().handler(sessionHandler.handle);

// Now your application handlers
router.route("/somepath/blah/").handler(function (routingContext) {

  var session = routingContext.session();
  session.put("foo", "bar");
  // etc

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The session handler will ensure that your session is automatically looked up (or created if no session exists)
from the session store and set on the routing context before it gets to your application handlers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_session">Using the session</h3>
<div class="paragraph">
<p>In your handlers you an access the session instance with <code><a href="jsdoc/routing_context-RoutingContext.html#session">session</a></code>.</p>
</div>
<div class="paragraph">
<p>You put data into the session with <code><a href="jsdoc/session-Session.html#put">put</a></code>,
you get data from the session with <code><a href="jsdoc/session-Session.html#get">get</a></code>, and you remove
data from the session with <code><a href="jsdoc/session-Session.html#remove">remove</a></code>.</p>
</div>
<div class="paragraph">
<p>The keys for items in the session are always strings. The values can be any type for a local session store, and for
a clustered session store they can be any basic type, or <code><a href="../../vertx-core/js/jsdoc/buffer-Buffer.html">Buffer</a></code>, <code><a href="../../vertx-core/js/jsdoc/json_object-JsonObject.html">JsonObject</a></code>,
<code><a href="../../vertx-core/js/jsdoc/json_array-JsonArray.html">JsonArray</a></code> or a serializable object, as the values have to serialized across the cluster.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of manipulating session data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var CookieHandler = require("vertx-apex-js/cookie_handler");

router.route().handler(CookieHandler.create().handle);
router.route().handler(sessionHandler.handle);

// Now your application handlers
router.route("/somepath/blah").handler(function (routingContext) {

  var session = routingContext.session();

  // Put some data from the session
  session.put("foo", "bar");

  // Retrieve some data from a session
  var age = session.get("age");

  // Remove some data from a session
  var obj = session.remove("myobj");

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sessions are automatically written back to the store after after responses are complete.</p>
</div>
<div class="paragraph">
<p>You can manually destroy a session using <code><a href="jsdoc/session-Session.html#destroy">destroy</a></code>. This will remove the session
from the context and the session store. Note that if there is no session a new one will be automatically created
for the next request from the browser that&#8217;s routed through the session handler.</p>
</div>
</div>
<div class="sect2">
<h3 id="_session_timeout">Session timeout</h3>
<div class="paragraph">
<p>Sessions will be automatically timed out if they are not accessed for a time greater than the timeout period. When
a session is timed out, it is removed from the store.</p>
</div>
<div class="paragraph">
<p>Sessions are automatically marked as accessed when a request arrives and the session is looked up and and when the
response is complete and the session is stored back in the store.</p>
</div>
<div class="paragraph">
<p>You can also use <code><a href="jsdoc/session-Session.html#setAccessed">setAccessed</a></code> to manually mark a session as accessed.</p>
</div>
<div class="paragraph">
<p>The session timeout can be configured when creating the session handler. Default timeout is 30 minutes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_authentication_authorisation">Authentication / authorisation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vert.x comes with some out of the box handlers for handling both authentication (login) and authorisation (seeing
whether you have rights for some resource).</p>
</div>
<div class="sect2">
<h3 id="_creating_an_auth_handler">Creating an auth handler</h3>
<div class="paragraph">
<p>To create an auth handler you need an instance of <code><a href="../../vertx-auth-service/js/jsdoc/auth_provider-AuthProvider.html">AuthProvider</a></code>. Auth provider is
used for authentication and authorisation of users. It uses a simple
role/permission model and, by default, is backed by Apache Shiro. For full information on auth provider and how
to use and configure it please consult the auth service documentation.</p>
</div>
<div class="paragraph">
<p>Like many services in Vert.x they can be instantiated locally, or you can create a proxy to an existing auth service
deployed as a verticle somewhere on the network. The latter case is useful if you have an app composed of many verticles
that want to do auth and you don&#8217;t want each verticle to have its own auth service instance, or perhaps you have a single
auth service managed somewhere on your network and you want all auth request to go through that.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a simple example of creating a basic auth provider that gets user data from a properties file and creating
an auth handler from that, but it&#8217;s the same principle whatever concrete auth provider you use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var ShiroAuthProvider = require("vertx-auth-js/shiro_auth_provider");
var BasicAuthHandler = require("vertx-apex-js/basic_auth_handler");

// Create a simple local auth service that gets user data from properties file
// See the AuthService documentation for how to configure the auth service

var config = {
};
config.Java.type("io.vertx.ext.auth.shiro.PropertiesAuthRealmConstants").PROPERTIES_PROPS_PATH_FIELD = "classpath:test-auth.properties";

var authProvider = ShiroAuthProvider.create(vertx, 'PROPERTIES', config);

var basicAuthHandler = BasicAuthHandler.create(authProvider);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll also need cookies and sessions enabled for auth handling to work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var CookieHandler = require("vertx-apex-js/cookie_handler");
var SessionHandler = require("vertx-apex-js/session_handler");
var LocalSessionStore = require("vertx-apex-js/local_session_store");
var BasicAuthHandler = require("vertx-apex-js/basic_auth_handler");

router.route().handler(CookieHandler.create().handle);
router.route().handler(SessionHandler.create(LocalSessionStore.create(vertx)).handle);

var basicAuthHandler = BasicAuthHandler.create(authProvider);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_handling_auth_in_your_application">Handling auth in your application</h3>
<div class="paragraph">
<p>Let&#8217;s say you want all requests to paths that start with <code>/private/</code> to be subject to auth. To do that you make sure
your auth handler is before your application handlers on those paths:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var CookieHandler = require("vertx-apex-js/cookie_handler");
var SessionHandler = require("vertx-apex-js/session_handler");
var LocalSessionStore = require("vertx-apex-js/local_session_store");
var AuthService = require("vertx-auth-js/auth_service");
var BasicAuthHandler = require("vertx-apex-js/basic_auth_handler");

router.route().handler(CookieHandler.create().handle);
router.route().handler(SessionHandler.create(LocalSessionStore.create(vertx)).handle);

var authService = AuthService.createEventBusProxy(vertx, "acme.authservice");
var basicAuthHandler = BasicAuthHandler.create(authProvider);

// All requests to paths starting with '/private/' will be protected
router.route("/private/*").handler(basicAuthHandler.handle);

router.route("/someotherpath").handler(function (routingContext) {

  // This will be public access - no login required

});

router.route("/private/somepath").handler(function (routingContext) {

  // This will require a login

  // This will have the value true
  var isLoggedIn = routingContext.session().isLoggedIn();

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the auth handler has successfully authenticated and authorised the user it will set the principal on the
session object, and the session will be marked as logged in. You can query the login status with
<code><a href="jsdoc/session-Session.html#isLoggedIn">isLoggedIn</a></code> and you can get the principal with
<code><a href="jsdoc/session-Session.html#getPrincipal">getPrincipal</a></code>.</p>
</div>
<div class="paragraph">
<p>If you want to cause the user to be logged out you can call <code><a href="jsdoc/session-Session.html#logout">logout</a></code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_http_basic_authentication">HTTP Basic Authentication</h3>
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/Basic_access_authentication">HTTP Basic Authentication</a> is a simple means of authentication
that can be appropriate for simple applications.</p>
</div>
<div class="paragraph">
<p>With basic auth, credentials are sent unencrypted across the wire in HTTP headers so it&#8217;s essential that you serve
your application using HTTPS not HTTP.</p>
</div>
<div class="paragraph">
<p>With basic auth, if a user requests a resource that requires authorisation, the basic auth handler will send back
a <code>401</code> response with the header <code>WWW-Authenticate</code> set. This prompts the browser to show a log-in dialogue and
prompt the user to enter their username and password.</p>
</div>
<div class="paragraph">
<p>The request is made to the resource again, this time with the <code>Authorization</code> header set, containing the username
and password encoded in Base64.</p>
</div>
<div class="paragraph">
<p>When the basic auth handler receives this information, it calls the configured <code><a href="../../vertx-auth-service/js/jsdoc/auth_provider-AuthProvider.html">auth service</a></code>
with the username and password to authenticate the user. If the authentication is successful the handler attempts
to authorise the user. If that is successful then the routing of the request is allowed to continue to the application
handlers, otherwise a <code>403</code> response is returned to signify that access is denied.</p>
</div>
<div class="paragraph">
<p>The auth handler can be set-up with a set of permissions and/or roles that are required for access to the resources to
be granted.</p>
</div>
</div>
<div class="sect2">
<h3 id="_redirect_auth_handler">Redirect auth handler</h3>
<div class="paragraph">
<p>With redirect auth handling the user is redirected to towards a login page in the case they are trying to access
a protected resource and they are not logged in.</p>
</div>
<div class="paragraph">
<p>The user then fills in the login form and submits it. This is handled by the server which authenticates
the user and, if authenticated redirects the user back to the original resource.</p>
</div>
<div class="paragraph">
<p>To use redirect auth you configure an instance of <code><a href="jsdoc/redirect_auth_handler-RedirectAuthHandler.html">RedirectAuthHandler</a></code> instead of a
basic auth handler.</p>
</div>
<div class="paragraph">
<p>You will also need to setup handlers to serve your actual login page, and a handler to handle the actual login itself.
To handle the login we provide a prebuilt handler <code><a href="jsdoc/form_login_handler-FormLoginHandler.html">FormLoginHandler</a></code> for the purpose.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of a simple app, using a redirect auth handler on the default redirect url <code>/loginpage</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var CookieHandler = require("vertx-apex-js/cookie_handler");
var SessionHandler = require("vertx-apex-js/session_handler");
var LocalSessionStore = require("vertx-apex-js/local_session_store");
var AuthService = require("vertx-auth-js/auth_service");
var RedirectAuthHandler = require("vertx-apex-js/redirect_auth_handler");
var FormLoginHandler = require("vertx-apex-js/form_login_handler");
var StaticHandler = require("vertx-apex-js/static_handler");

router.route().handler(CookieHandler.create().handle);
router.route().handler(SessionHandler.create(LocalSessionStore.create(vertx)).handle);

var authService = AuthService.createEventBusProxy(vertx, "acme.authservice");
var redirectAuthHandler = RedirectAuthHandler.create(authProvider);

// All requests to paths starting with '/private/' will be protected
router.route("/private/*").handler(redirectAuthHandler.handle);

// Handle the actual login
router.route("/login").handler(FormLoginHandler.create(authProvider).handle);

// Set a static server to serve static resources, e.g. the login page
router.route().handler(StaticHandler.create().handle);

router.route("/someotherpath").handler(function (routingContext) {
  // This will be public access - no login required
});

router.route("/private/somepath").handler(function (routingContext) {

  // This will require a login

  // This will have the value true
  var isLoggedIn = routingContext.session().isLoggedIn();

});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_required_roles_and_permissions">Configuring required roles and permissions</h3>
<div class="paragraph">
<p>With any auth handler you can also configure required roles and permissions to access the resource.</p>
</div>
<div class="paragraph">
<p>By default, if no roles/permissions are configured then it is sufficient to be logged in to access the resource, otherwise
the user must be both logged in (authenticated) and have the required roles/permissions.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of configuring an app so that different roles/permissions are required for different parts of the
app:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var RedirectAuthHandler = require("vertx-apex-js/redirect_auth_handler");

var managerAuthHandler = RedirectAuthHandler.create(authProvider);
managerAuthHandler.addRole("manager").addRole("admin");

// Roles "manager" and "admin" have access to /private/managers
router.route("/private/managers").handler(managerAuthHandler.handle);

var settingsAuthHandler = RedirectAuthHandler.create(authProvider);
settingsAuthHandler.addRole("admin");

// Only "admin" has access to /private/settings
router.route("/private/settings").handler(settingsAuthHandler.handle);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_oauth">OAuth</h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serving_static_resources">Serving static resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apex comes with an out of the box handler for serving static web resources so you can write static web servers
very easily.</p>
</div>
<div class="paragraph">
<p>To serve static resources such as <code>.html</code>, <code>.css</code>, <code>.js</code> or any other static resource, you use an instance of
<code><a href="jsdoc/static_handler-StaticHandler.html">StaticHandler</a></code>.</p>
</div>
<div class="paragraph">
<p>Any requests to paths handled by the static handler will result in files being served from a directory on the file system
or from the classpath. The default static file directory is <code>webroot</code> but this can be configured.</p>
</div>
<div class="paragraph">
<p>In the following example all requests to paths starting with <code>/static/</code> will get served from the directory <code>webroot</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var StaticHandler = require("vertx-apex-js/static_handler");

router.route("/static/*").handler(StaticHandler.create().handle);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, if there was a request with path <code>/static/css/mystyles.css</code> the static serve will look for a file in the
directory <code>webroot/static/css/mystyle.css</code>.</p>
</div>
<div class="paragraph">
<p>It will also look for a file on the classpath called <code>webroot/static/css/mystyle.css</code>. This means you can package up all your
static resources into a jar file (or fatjar) and distribute them like that.</p>
</div>
<div class="paragraph">
<p>When Vert.x finds a resource on the classpath for the first time it extracts it and caches it in a temporary directory
on disk so it doesn&#8217;t have to do this each time.</p>
</div>
<div class="sect2">
<h3 id="_configuring_caching">Configuring caching</h3>
<div class="paragraph">
<p>By default the static handler will set cache headers to enable browsers to effectively cache files.</p>
</div>
<div class="paragraph">
<p>Apex sets the headers <code>cache-control</code>,<code>last-modified</code>, and <code>date</code>.</p>
</div>
<div class="paragraph">
<p><code>cache-control</code> is set to <code>max-age=86400</code> by default. This corresponds to one day. This can be configured with
<code><a href="jsdoc/static_handler-StaticHandler.html#setMaxAgeSeconds">setMaxAgeSeconds</a></code> if required.</p>
</div>
<div class="paragraph">
<p>If a browser sends a GET or a HEAD request with an <code>if-modified-since</code> header and the resource has not been modified
since that date, a <code>304</code> status is returned which tells the browser to use its locally cached resource.</p>
</div>
<div class="paragraph">
<p>If handling of cache headers is not required, it can be disabled with <code><a href="jsdoc/static_handler-StaticHandler.html#setCachingEnabled">setCachingEnabled</a></code>.</p>
</div>
<div class="paragraph">
<p>When cache handling is enabled Apex will cache the last modified date of resources in memory, this avoids a disk hit
to check the actual last modified date every time.</p>
</div>
<div class="paragraph">
<p>Entries in the cache have an expiry time, and after that time, the file on disk will be checked again and the cache
entry updated.</p>
</div>
<div class="paragraph">
<p>If you know that your files never change on disk, then the cache entry will effectively never expire. This is the
default.</p>
</div>
<div class="paragraph">
<p>If you know that your files might change on disk when the server is running then you can set files read only to false with
<code><a href="jsdoc/static_handler-StaticHandler.html#setFilesReadOnly">setFilesReadOnly</a></code>.</p>
</div>
<div class="paragraph">
<p>To enable the maximum number of entries that can be cached in memory at any one time you can use
<code><a href="jsdoc/static_handler-StaticHandler.html#setMaxCacheSize">setMaxCacheSize</a></code>.</p>
</div>
<div class="paragraph">
<p>To configure the expiry time of cache entries you can use <code><a href="jsdoc/static_handler-StaticHandler.html#setCacheEntryTimeout">setCacheEntryTimeout</a></code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_the_index_page">Configuring the index page</h3>
<div class="paragraph">
<p>Any requests to the root path <code>/</code> will cause the index page to be served. By default the index page is <code>index.html</code>.
This can be configured with <code><a href="jsdoc/static_handler-StaticHandler.html#setIndexPage">setIndexPage</a></code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_changing_the_web_root">Changing the web root</h3>
<div class="paragraph">
<p>By default static resources will be served from the directory <code>webroot</code>. To configure this use
<code><a href="jsdoc/static_handler-StaticHandler.html#setWebRoot">setWebRoot</a></code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_serving_hidden_files">Serving hidden files</h3>
<div class="paragraph">
<p>By default the serve will serve hidden files (files starting with <code>.</code>).</p>
</div>
<div class="paragraph">
<p>If you do not want hidden files to be served you can configure it with <code><a href="jsdoc/static_handler-StaticHandler.html#setIncludeHidden">setIncludeHidden</a></code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_directory_listing">Directory listing</h3>
<div class="paragraph">
<p>The server can also perform directory listing. By default directory listing is disabled. To enabled it use
<code><a href="jsdoc/static_handler-StaticHandler.html#setDirectoryListing">setDirectoryListing</a></code>.</p>
</div>
<div class="paragraph">
<p>When directory listing is enabled the content returned depends on the content type in the <code>accept</code> header.</p>
</div>
<div class="paragraph">
<p>For <code>text/html</code> directory listing, the template used to render the directory listing page can be configured with
<code><a href="jsdoc/static_handler-StaticHandler.html#setDirectoryTemplate">setDirectoryTemplate</a></code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cors_handling">CORS handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">Cross Origin Resource Sharing</a> is a safe mechanism for
allowing resources to be requested from one domain and served from another.</p>
</div>
<div class="paragraph">
<p>Apex includes a handler <code><a href="jsdoc/cors_handler-CorsHandler.html">CorsHandler</a></code> that handles the CORS protocol for you.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var CorsHandler = require("vertx-apex-js/cors_handler");

// Will only accept GET requests from origin "vertx.io"
router.route().handler(CorsHandler.create("vertx\\.io").allowedMethod('GET').handle);

router.route().handler(function (routingContext) {

  // Your app handlers

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>TODO more CORS docs</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_templates">Templates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apex includes dynamic page generation capabilities by including out of the box support for several popular template
engines. You can also easily add your own.</p>
</div>
<div class="paragraph">
<p>Template engines are described by <code><a href="jsdoc/template_engine-TemplateEngine.html">TemplateEngine</a></code>. In order to render a template
<code><a href="jsdoc/template_engine-TemplateEngine.html#render">render</a></code> is used.</p>
</div>
<div class="paragraph">
<p>The simplest way to use templates is not to call the template engine directly but to use the
<code><a href="jsdoc/template_handler-TemplateHandler.html">TemplateHandler</a></code>.
This handler calls the template engine for you based on the path in the HTTP request.</p>
</div>
<div class="paragraph">
<p>By default the template handler will look for templates in a directory called <code>templates</code>. This can be configured.</p>
</div>
<div class="paragraph">
<p>The handler will return the results of rendering with a content type of <code>text/html</code> by default. This can also be configured.</p>
</div>
<div class="paragraph">
<p>When you create the template handler you pass in an instance of the template engine you want.</p>
</div>
<div class="paragraph">
<p>Here are some examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var HandlebarsTemplateEngine = require("vertx-apex-js/handlebars_template_engine");
var TemplateHandler = require("vertx-apex-js/template_handler");

var engine = HandlebarsTemplateEngine.create();
var handler = TemplateHandler.create(engine);

// This will route all GET requests starting with /dynamic/ to the template handler
// E.g. /dynamic/graph.hbs will look for a template in /templates/dynamic/graph.hbs
router.get("/dynamic/").handler(handler.handle);

// Route all GET requests for resource ending in .hbs to the template handler
router.getWithRegex(".+\\.hbs").handler(handler.handle);</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_mvel_template_engine">MVEL template engine</h3>
<div class="paragraph">
<p>When using the <code><a href="jsdoc/mvel_template_engine-MVELTemplateEngine.html">MVEL template engine</a></code>, it will by default look for
templates with the <code>.templ</code> extension if no extension is specified in the file name.</p>
</div>
<div class="paragraph">
<p>The routing context <code><a href="jsdoc/routing_context-RoutingContext.html">RoutingContext</a></code> is available
in the MVEL template as the <code>context</code> variable, this means you can render the template based on anything in the context
including the request, response, session or context data.</p>
</div>
<div class="paragraph">
<p>Here are some examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The request path is @{context.request().path()}

The variable 'foo' from the session is @{context.session().get('foo')}

The value 'bar' from the context data is @{context.get('bar')}</pre>
</div>
</div>
<div class="paragraph">
<p>Please consult the <a href="http://mvel.codehaus.org/MVEL+2.0+Templating+Guide">MVEL templates documentation</a> for how to write
MVEL templates.</p>
</div>
</div>
<div class="sect2">
<h3 id="_jade_template_engine">Jade template engine</h3>
<div class="paragraph">
<p>When using the <code><a href="jsdoc/jade_template_engine-JadeTemplateEngine.html">Jade template engine</a></code>, it will by default look for
templates with the <code>.jade</code> extension if no extension is specified in the file name.</p>
</div>
<div class="paragraph">
<p>The routing context <code><a href="jsdoc/routing_context-RoutingContext.html">RoutingContext</a></code> is available
in the Jade template as the <code>context</code> variable, this means you can render the template based on anything in the context
including the request, response, session or context data.</p>
</div>
<div class="paragraph">
<p>Here are some examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>!!! 5
html
  head
    title= context.get('foo') + context.request().path()
  body</pre>
</div>
</div>
<div class="paragraph">
<p>Please consult the <a href="https://github.com/neuland/jade4j">Jade4j documentation</a> for how to write
Jade templates.</p>
</div>
</div>
<div class="sect2">
<h3 id="_handlebars_template_engine">Handlebars template engine</h3>
<div class="paragraph">
<p>When using the <code><a href="jsdoc/handlebars_template_engine-HandlebarsTemplateEngine.html">Handlebars template engine</a></code>, it will by default look for
templates with the <code>.hbs</code> extension if no extension is specified in the file name.</p>
</div>
<div class="paragraph">
<p>Handlebars templates are not able to call arbitrary methods in objects so we can&#8217;t just pass the routing context
into the template and let the template introspect it like we can with other template engines.</p>
</div>
<div class="paragraph">
<p>Instead, the context <code><a href="jsdoc/routing_context-RoutingContext.html#data">data</a></code> is available in the template.</p>
</div>
<div class="paragraph">
<p>If you want to have access to other data like the request path, request params or session data you should
add it the context data in a handler before the template handler. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var HandlebarsTemplateEngine = require("vertx-apex-js/handlebars_template_engine");
var TemplateHandler = require("vertx-apex-js/template_handler");

var engine = HandlebarsTemplateEngine.create();
var handler = TemplateHandler.create(engine);

router.get("/dynamic").handler(function (routingContext) {

  routingContext.put("request_path", routingContext.request().path());
  routingContext.put("session_data", routingContext.session().data());

  routingContext.next();
});

router.get("/dynamic/").handler(handler.handle);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please consult the <a href="https://github.com/jknack/handlebars.java">Handlebars Java port documentation</a> for how to write
handlebars templates.</p>
</div>
</div>
<div class="sect2">
<h3 id="_thymeleaf_template_engine">Thymeleaf template engine</h3>
<div class="paragraph">
<p>When using the <code><a href="jsdoc/thymeleaf_template_engine-ThymeleafTemplateEngine.html">Thymeleaf template engine</a></code>, it will by default look for
templates with the <code>.html</code> extension if no extension is specified in the file name.</p>
</div>
<div class="paragraph">
<p>The routing context <code><a href="jsdoc/routing_context-RoutingContext.html">RoutingContext</a></code> is available
in the Thymeleaf template as the <code>context</code> variable, this means you can render the template based on anything in the context
including the request, response, session or context data.</p>
</div>
<div class="paragraph">
<p>Here are some examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[snip]
p th:text="${context.get('foo')}"/p
p th:text="${context.get('bar')}"/p
p th:text="${context.normalisedPath()}"/p
p th:text="${context.request().params().get('param1')}"/p
p th:text="${context.request().params().get('param2')}"/p
[snip]</pre>
</div>
</div>
<div class="paragraph">
<p>Please consult the <a href="http://www.thymeleaf.org/">Thymeleaf documentation</a> for how to write
Thymeleaf templates.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_error_handler">Error handler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can render your own errors using a template handler or otherwise but Apex also includes an out of the boxy
"pretty" error handler that can render error pages for you.</p>
</div>
<div class="paragraph">
<p>The handler is <code><a href="jsdoc/error_handler-ErrorHandler.html">ErrorHandler</a></code>. To use the error handler just set it as a
failure handler for any paths that you want covered.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_request_logger">Request logger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apex includes a handler <code><a href="jsdoc/logger_handler-LoggerHandler.html">LoggerHandler</a></code> that you can use to log HTTP requests.</p>
</div>
<div class="paragraph">
<p>By default requests are logged to the Vert.x logger which can be configured to use JUL logging, log4j or SLF4J.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serving_favicons">Serving favicons</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apex includes the handler <code><a href="jsdoc/favicon_handler-FaviconHandler.html">FaviconHandler</a></code> especially for serving favicons.</p>
</div>
<div class="paragraph">
<p>Favicons can be specified using a path to the filesystem, or by default Apex will look for a file on the classpath
with the name <code>favicon.ico</code>. This means you bundle the favicon in the jar of your application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_timeout_handler">Timeout handler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apex includes a timeout handler that you can use to timeout requests if they take too long to process.</p>
</div>
<div class="paragraph">
<p>This is configured using an instance of <code><a href="jsdoc/timeout_handler-TimeoutHandler.html">TimeoutHandler</a></code>.</p>
</div>
<div class="paragraph">
<p>If a request times out before the response is written a <code>408</code> response will be returned to the client.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of using a timeout handler which will timeout all requests to paths starting with <code>/foo</code> after 5
seconds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var TimeoutHandler = require("vertx-apex-js/timeout_handler");

router.route("/foo/").handler(TimeoutHandler.create(5000).handle);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_response_time_handler">Response time handler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This handler sets the header <code>x-response-time</code> response header containing the time from when the request was received
to when the response headers were written, in ms., e.g.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>x-response-time: 1456ms</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sockjs">SockJS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SockJS is a client side JavaScript library and protocol which provides a simple WebSocket-like interface allowing you
to make connections to SockJS servers irrespective of whether the actual browser or network will allow real WebSockets.</p>
</div>
<div class="paragraph">
<p>It does this by supporting various different transports between browser and server, and choosing one at run-time
according to browser and network capabilities.</p>
</div>
<div class="paragraph">
<p>All this is transparent to you - you are simply presented with the WebSocket-like interface which <em>just works</em>.</p>
</div>
<div class="paragraph">
<p>Please see the <a href="https://github.com/sockjs/sockjs-client">SockJS website</a> for more information on SockJS.</p>
</div>
<div class="sect2">
<h3 id="_sockjs_handler">SockJS handler</h3>
<div class="paragraph">
<p>Vert.x provides an out of the box handler called <code><a href="jsdoc/sock_js_handler-SockJSHandler.html">SockJSHandler</a></code> for
using SockJS in your Apex applications.</p>
</div>
<div class="paragraph">
<p>You should create one handler per SockJS application using <code><a href="jsdoc/sock_js_handler-SockJSHandler.html#create">SockJSHandler.create</a></code>.
You can also specify configuration options when creating the instance. The configuration options are described with
an instance of <code><a href="../cheatsheet/SockJSHandlerOptions.html">SockJSHandlerOptions</a></code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var Router = require("vertx-apex-js/router");
var SockJSHandler = require("vertx-apex-js/sock_js_handler");

var router = Router.router(vertx);

var options = {
  "heartbeatPeriod" : 2000
};

var sockJSHandler = SockJSHandler.create(vertx, options);

router.route("/myapp").handler(sockJSHandler.handle);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_handling_sockjs_sockets">Handling SockJS sockets</h3>
<div class="paragraph">
<p>On the server-side you set a handler on the SockJS handler, and
this will be called every time a SockJS connection is made from a client:</p>
</div>
<div class="paragraph">
<p>The object passed into the handler is a <code><a href="jsdoc/sock_js_socket-SockJSSocket.html">SockJSSocket</a></code>. This has a familiar
socket-like interface which you can read and write to similarly to a <code><a href="../../vertx-core/js/jsdoc/net_socket-NetSocket.html">NetSocket</a></code> or
a <code><a href="../../vertx-core/js/jsdoc/web_socket-WebSocket.html">WebSocket</a></code>. It also implements <code><a href="../../vertx-core/js/jsdoc/read_stream-ReadStream.html">ReadStream</a></code> and
<code><a href="../../vertx-core/js/jsdoc/write_stream-WriteStream.html">WriteStream</a></code> so you can pump it to and from other read and write streams.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of a simple SockJS handler that simply echoes back any back any data that it reads:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var Router = require("vertx-apex-js/router");
var SockJSHandler = require("vertx-apex-js/sock_js_handler");

var router = Router.router(vertx);

var options = {
  "heartbeatPeriod" : 2000
};

var sockJSHandler = SockJSHandler.create(vertx, options);

sockJSHandler.socketHandler(function (sockJSSocket) {

  // Just echo the data back
  sockJSSocket.handler(sockJSSocket.write);
});

router.route("/myapp").handler(sockJSHandler.handle);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_client_side">The client side</h3>
<div class="paragraph">
<p>In client side JavaScript you use the SockJS client side library to make connections.</p>
</div>
<div class="paragraph">
<p>You can find that <a href="http://cdn.sockjs.org/sockjs-0.3.4.js">here</a>.
The minified version is <a href="http://cdn.sockjs.org/sockjs-0.3.4.min.js">here</a>.</p>
</div>
<div class="paragraph">
<p>Full details for using the SockJS JavaScript client are on the <a href="https://github.com/sockjs/sockjs-client">SockJS website</a>,
but in summary you use it something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>var sock = new SockJS('http://mydomain.com/myapp');

sock.onopen = function() {
  console.log('open');
};

sock.onmessage = function(e) {
  console.log('message', e.data);
};

sock.onclose = function() {
  console.log('close');
};

sock.send('test');

sock.close();</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_the_sockjs_handler">Configuring the SockJS handler</h3>
<div class="paragraph">
<p>The handler can be configured with various options using <code><a href="../cheatsheet/SockJSHandlerOptions.html">SockJSHandlerOptions</a></code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>insertJSESSIONID</code></dt>
<dd>
<p>Insert a JSESSIONID cookie so load-balancers ensure requests for a specific SockJS session
are always routed to the correct server. Default is <code>true</code>.</p>
</dd>
<dt class="hdlist1"><code>sessionTimeout</code></dt>
<dd>
<p>The server sends a <code>close</code> event when a client receiving connection have not been seen for a while.
This delay is configured by this setting. By default the <code>close</code> event will be emitted when a receiving
connection wasn&#8217;t seen for 5 seconds.</p>
</dd>
<dt class="hdlist1"><code>heartbeaPperiod</code></dt>
<dd>
<p>In order to keep proxies and load balancers from closing long running http
requests we need to pretend that the connection is active and send a heartbeat packet once in a while.
This setting controls how often this is done. By default a heartbeat packet is sent every 25 seconds.</p>
</dd>
<dt class="hdlist1"><code>maxBytesStreaming</code></dt>
<dd>
<p>Most streaming transports save responses on the client side and don&#8217;t free memory used
by delivered messages. Such transports need to be garbage-collected once in a while. <code>max_bytes_streaming</code> sets a
minimum number of bytes that can be send over a single http streaming request before it will be closed. After that
client needs to open new request. Setting this value to one effectively disables streaming and will make streaming
transports to behave like polling transports. The default value is 128K.</p>
</dd>
<dt class="hdlist1"><code>libraryURL</code></dt>
<dd>
<p>Transports which don&#8217;t support cross-domain communication natively ('eventsource' to name one)
use an iframe trick. A simple page is served from the SockJS server (using its foreign domain) and is placed in an
invisible iframe. Code run from this iframe doesn&#8217;t need to worry about cross-domain issues, as it&#8217;s being run from
domain local to the SockJS server. This iframe also does need to load SockJS javascript client library, and this option
lets you specify its url (if you&#8217;re unsure, point it to the latest minified SockJS client release, this is the default).
The default value is <code><a href="http://cdn.sockjs.org/sockjs-0.3.4.min.js" class="bare">http://cdn.sockjs.org/sockjs-0.3.4.min.js</a></code></p>
</dd>
<dt class="hdlist1"><code>disabledTransports</code></dt>
<dd>
<p>This is a list of transports that you want to disable. Possible values are
WEBSOCKET, EVENT_SOURCE, HTML_FILE, JSON_P, XHR.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sockjs_event_bus_bridge">SockJS event bus bridge</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apex comes with a built-in SockJS socket handler called the event bus bridge which effectively extends the server-side
Vert.x event bus into client side JavaScript.</p>
</div>
<div class="paragraph">
<p>This creates a distributed event bus which not only spans multiple Vert.x instances on the server side, but includes
client side JavaScript running in browsers.</p>
</div>
<div class="paragraph">
<p>We can therefore create a huge distributed bus encompassing many browsers and servers. The browsers don&#8217;t have to
be connected to the same server as long as the servers are connected.</p>
</div>
<div class="paragraph">
<p>This is done by providing a simple client side JavaScript library called <code>vertxbus.js</code> which provides an API
very similar to the server-side Vert.x event-bus API, which allows you to send and publish messages to the event bus
and register handlers to receive messages.</p>
</div>
<div class="paragraph">
<p>This JavaScript library uses the JavaScript SockJS client to tunnel the event bus traffic over SockJS connections
terminating at at a <code><a href="jsdoc/sock_js_handler-SockJSHandler.html">SockJSHandler</a></code> on the server-side.</p>
</div>
<div class="paragraph">
<p>A special SockJS socket handler is then installed on the <code><a href="jsdoc/sock_js_handler-SockJSHandler.html">SockJSHandler</a></code> which
handles the SockJS data and bridges it to and from the server side event bus.</p>
</div>
<div class="paragraph">
<p>To activate the bridge you simply call
<code><a href="jsdoc/sock_js_handler-SockJSHandler.html#bridge">bridge</a></code> on the
SockJS handler.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var Router = require("vertx-apex-js/router");
var SockJSHandler = require("vertx-apex-js/sock_js_handler");

var router = Router.router(vertx);

var sockJSHandler = SockJSHandler.create(vertx);
var options = {
};
sockJSHandler.bridge(options);

router.route("/eventbus").handler(sockJSHandler.handle);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In client side JavaScript you use the 'vertxbus.js` library to create connections to the event bus and to send
and receive messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;script src="http://cdn.sockjs.org/sockjs-0.3.4.min.js"&gt;&lt;/script&gt;
&lt;script src='vertxbus.js'&gt;&lt;/script&gt;

&lt;script&gt;

var eb = new vertx.EventBus('http://localhost:8080/eventbus');

eb.onopen = function() {

  // set a handler to receive a message
  eb.registerHandler('some-address', function(message) {
    console.log('received a message: ' + JSON.stringify(message);
  });

  // send a message
  eb.send('some-address', {name: 'tim', age: 587});

}

&lt;/script&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The first thing the example does is to create a instance of the event bus</p>
</div>
<div class="literalblock">
<div class="content">
<pre>var eb = new vertx.EventBus('http://localhost:8080/eventbus');</pre>
</div>
</div>
<div class="paragraph">
<p>The parameter to the constructor is the URI where to connect to the event bus. Since we create our bridge with
the prefix <code>eventbus</code> we will connect there.</p>
</div>
<div class="paragraph">
<p>You can&#8217;t actually do anything with the connection until it is opened. When it is open the <code>onopen</code> handler will be called.</p>
</div>
<div class="sect2">
<h3 id="_securing_the_bridge">Securing the Bridge</h3>
<div class="paragraph">
<p>If you started a bridge like in the above example without securing it, and attempted to send messages through
it you&#8217;d find that the messages mysteriously disappeared. What happened to them?</p>
</div>
<div class="paragraph">
<p>For most applications you probably don&#8217;t want client side JavaScript being able to send just any message to any
handlers on the server side or to all other browsers.</p>
</div>
<div class="paragraph">
<p>For example, you may have a service on the event bus which allows data to be accessed or deleted. We don&#8217;t want
badly behaved or malicious clients being able to delete all the data in your database!</p>
</div>
<div class="paragraph">
<p>Also, we don&#8217;t necessarily want any client to be able to listen in on any event bus address.</p>
</div>
<div class="paragraph">
<p>To deal with this, a SockJS bridge will by default refuse to let through any messages. It&#8217;s up to you to tell the
bridge what messages are ok for it to pass through. (There is an exception for reply messages which are always allowed through).</p>
</div>
<div class="paragraph">
<p>In other words the bridge acts like a kind of firewall which has a default <em>deny-all</em> policy.</p>
</div>
<div class="paragraph">
<p>Configuring the bridge to tell it what messages it should pass through is easy.</p>
</div>
<div class="paragraph">
<p>You can specify which <em>matches</em> you want to allow for inbound and outbound traffic using the
<code><a href="../cheatsheet/BridgeOptions.html">BridgeOptions</a></code> that you pass in when calling bridge.</p>
</div>
<div class="paragraph">
<p>Each match is a <code><a href="../cheatsheet/PermittedOptions.html">PermittedOptions</a></code> object:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><a href="../cheatsheet/PermittedOptions.html#address">address</a></code></dt>
<dd>
<p>This represents the exact address the message is being sent to. If you want to allow messages based on
an exact address you use this field.</p>
</dd>
<dt class="hdlist1"><code><a href="../cheatsheet/PermittedOptions.html#addressRegex">addressRegex</a></code></dt>
<dd>
<p>This is a regular expression that will be matched against the address. If you want to allow messages
based on a regular expression you use this field. If the <code>address</code> field is specified this field will be ignored.</p>
</dd>
<dt class="hdlist1"><code><a href="../cheatsheet/PermittedOptions.html#match">match</a></code></dt>
<dd>
<p>This allows you to allow messages based on their structure. Any fields in the match must exist in the
message with the same values for them to be allowed. This currently only works with JSON messages.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If a message is <em>in-bound</em> (i.e. being sent from client side JavaScript to the server) when it is received Apex
will look through any inbound permitted matches. If any match, it will be allowed through.</p>
</div>
<div class="paragraph">
<p>If a message is <em>out-bound</em> (i.e. being sent from the server to client side JavaScript) before it is sent to the client
Apex will look through any inbound permitted matches. If any match, it will be allowed through.</p>
</div>
<div class="paragraph">
<p>The actual matching works as follows:</p>
</div>
<div class="paragraph">
<p>If an <code>address</code> field has been specified then the <code>address</code> must match <em>exactly</em> with the address of the message
for it to be considered matched.</p>
</div>
<div class="paragraph">
<p>If an <code>address</code> field has not been specified and an <code>addressRegex</code> field has been specified then the regular expression
in <code>address_re</code> must match with the address of the message for it to be considered matched.</p>
</div>
<div class="paragraph">
<p>If a <code>match</code> field has been specified, then also the structure of the message must match. Structuring matching works
by looking at all the fields and values in the match object and checking they all exist in the actual message body.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var Router = require("vertx-apex-js/router");
var SockJSHandler = require("vertx-apex-js/sock_js_handler");

var router = Router.router(vertx);

var sockJSHandler = SockJSHandler.create(vertx);


// Let through any messages sent to 'demo.orderMgr' from the client
var inboundPermitted1 = {
  "address" : "demo.orderMgr"
};

// Allow calls to the address 'demo.persistor' from the client as long as the messages
// have an action field with value 'find' and a collection field with value
// 'albums'
var inboundPermitted2 = {
  "address" : "demo.persistor",
  "match" : {
    "action" : "find",
    "collection" : "albums"
  }
};

// Allow through any message with a field `wibble` with value `foo`.
var inboundPermitted3 = {
  "match" : {
    "wibble" : "foo"
  }
};

// First let's define what we're going to allow from server -&gt; client

// Let through any messages coming from address 'ticker.mystock'
var outboundPermitted1 = {
  "address" : "ticker.mystock"
};

// Let through any messages from addresses starting with "news." (e.g. news.europe, news.usa, etc)
var outboundPermitted2 = {
  "addressRegex" : "news\\..+"
};

// Let's define what we're going to allow from client -&gt; server
var options = {
  "inboundPermitteds" : [
    inboundPermitted1,
    inboundPermitted1,
    inboundPermitted3
  ],
  "outboundPermitteds" : [
    outboundPermitted1,
    outboundPermitted2
  ]
};

sockJSHandler.bridge(options);

router.route("/eventbus").handler(sockJSHandler.handle);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_requiring_authorisation_for_messages">Requiring authorisation for messages</h3>
<div class="paragraph">
<p>The event bus bridge can also be configured to use the Apex authorisation functionality to require
authorisation for messages, either in-bound or out-bound on the bridge.</p>
</div>
<div class="paragraph">
<p>To do this, you can add extra fields to the match described in the previous section that determine what role and/or
permission is required for the match.</p>
</div>
<div class="paragraph">
<p>To declare that a specific role for the logged-in user is required in order to access allow the messages you use the
<code><a href="../cheatsheet/PermittedOptions.html#requiredRole">requiredRole</a></code> field.</p>
</div>
<div class="paragraph">
<p>To declare that a specific permission for the logged-in user is required in order to access allow the messages you use the
<code><a href="../cheatsheet/PermittedOptions.html#requiredPermission">requiredPermission</a></code> field.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">// Let through any messages sent to 'demo.orderMgr' from the client
var inboundPermitted = {
  "address" : "demo.adminService"
};

// But only if the user is logged in and has the role "admin"
inboundPermitted.requiredRole = "admin";

var options = {
  "inboundPermitteds" : [
    inboundPermitted
  ]
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the user to be authorised they must be first logged in and secondly have the required role.</p>
</div>
<div class="paragraph">
<p>To handle the login and actually auth you can configure the normal Vert.x auth handlers. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-js" data-lang="js">var Router = require("vertx-apex-js/router");
var SockJSHandler = require("vertx-apex-js/sock_js_handler");
var CookieHandler = require("vertx-apex-js/cookie_handler");
var SessionHandler = require("vertx-apex-js/session_handler");
var LocalSessionStore = require("vertx-apex-js/local_session_store");
var ShiroAuthProvider = require("vertx-auth-js/shiro_auth_provider");
var BasicAuthHandler = require("vertx-apex-js/basic_auth_handler");

var router = Router.router(vertx);

// Let through any messages sent to 'demo.orderMgr' from the client
var inboundPermitted = {
  "address" : "demo.adminService"
};

// But only if the user is logged in and has the role "admin"
inboundPermitted.requiredRole = "admin";

var sockJSHandler = SockJSHandler.create(vertx);
sockJSHandler.bridge({
  "inboundPermitteds" : [
    inboundPermitted
  ]
});

// Now set up some basic auth handling:

router.route().handler(CookieHandler.create().handle);
router.route().handler(SessionHandler.create(LocalSessionStore.create(vertx)).handle);

var authConfig = {
};
authConfig.Java.type("io.vertx.ext.auth.shiro.PropertiesAuthRealmConstants").PROPERTIES_PROPS_PATH_FIELD = "classpath:test-auth.properties";
var authProvider = ShiroAuthProvider.create(vertx, 'PROPERTIES', authConfig);

var basicAuthHandler = BasicAuthHandler.create(authProvider);

router.route("/eventbus/").handler(basicAuthHandler.handle);


router.route("/eventbus/").handler(sockJSHandler.handle);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-04-02 11:03:32 BST
</div>
</div>
</body>
</html>