<!DOCTYPE html><html lang=en><head><title>Blog</title><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta content="width=device-width,initial-scale=1" name=viewport><meta content="Vert.x is a tool-kit for building reactive applications on the JVM." name=description><link href=http://vertx.io/stylesheets/main.css media=screen rel=stylesheet><link href=http://vertx.io/stylesheets/font-awesome.min.css media=screen rel=stylesheet><link href=http://vertx.io/javascripts/styles/rainbow.min.css media=screen rel=stylesheet><!--[if lt IE 9]><script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script><![endif]--><link href=http://vertx.io/assets/favicons/vertx-favicon-5.ico rel="shortcut icon"><link href="http://fonts.googleapis.com/css?family=Ubuntu:400,500,700,400italic" rel=stylesheet type=text/css><link rel=alternate type=application/rss+xml title=RSS href=http://vertx.io/feed.xml><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-30144458-1', 'auto');
    ga('send', 'pageview');</script></head><body><a href="http://www.reactivemanifesto.org/" id=reactive-manifesto-banner><img style="border: 0; position: fixed; right: 0; top:0; z-index: 9000" src=http://d379ifj7s9wntv.cloudfront.net/reactivemanifesto/images/ribbons/we-are-reactive-black-right.png></a> <a id=skippy class="sr-only sr-only-focusable" href=#content><div class=container><span class=skiplink-text>Skip to main content</span></div></a><header class="navbar navbar-default navbar-static-top" id=top role=banner><div class=container><div class=navbar-header><button class="navbar-toggle collapsed" type=button data-toggle=collapse data-target=#vertx-navbar-collapse><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="http://vertx.io/" class=navbar-brand><img alt=Brand src=http://vertx.io/assets/logo-sm.png></a></div><nav class="collapse navbar-collapse" id=vertx-navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=https://bintray.com/vertx/downloads/distribution/view>Download</a></li><li><a href="http://vertx.io/docs/">Documentation</a></li><li><a href=https://github.com/vert-x3/wiki/wiki>Wiki</a></li><li><a href="http://vertx.io/community/">Community</a></li><li><a href=http://vertx.io/blog/blog.html>Blog</a></li><li><a href="http://vertx.io/vertx2/" class=vertx-2-link>Vert.x 2</a></li></ul></nav></div></header><div class=container><div class="row blog"><div class="col-sm-8 blog-main"><article class=blog-post><h2 class=blog-post-title><a href=/blog/vert-x3-says-hello-to-npm-users/index.html>Vert.x3 says &quot;hello&quot; to NPM users</a></h2><p class=blog-post-meta>13th July 2015 by <a href=http://github.com/pmlopes>pmlopes</a></p><article><p>In programming literature it has become the standard to create a hello world program as the first example. In this<br>article I’ll be demonstrating how <code>NPM</code> users can quickly get started with <code>vert.x</code>. You will see that it is not<br>that different and in fact it can be done using the tools you’re used to. Note that although we are using <code>NPM</code> we are<br>not relying on <code>node.js</code>, all <code>javascript</code> code runs on the <code>JVM</code>.</p><h2 id=hello-world-examples>Hello World Examples</h2><p>Here are four simple hello world examples. The comments in the code explain how the code works and the text around it<br>explain what it does and how to test it.</p><h2 id=hello-console>Hello Console</h2><p>This example is about as plain as it can get. It prints the words “<code>Hello World</code>“ to the terminal. If you’re a<br>javascript developer you should be already used to <code>npm</code> and know that you always start a project with the file<br><code>package.json</code>:</p><pre><code class="hljs javascript">{
  <span class=hljs-string>"name"</span>: <span class=hljs-string>"vertx3-hello-console"</span>,
  <span class=hljs-string>"private"</span>: <span class=hljs-literal>true</span>,
  <span class=hljs-string>"dependencies"</span>: {
    <span class=hljs-string>"vertx3-min"</span>: <span class=hljs-string>"3.0.0-1"</span>
  },
  <span class=hljs-string>"scripts"</span>: {
    <span class=hljs-string>"start"</span>: <span class=hljs-string>"./node_modules/.bin/vertx run server.js"</span>
  }
}</code></pre><p>Note that we have a dependency wich is obvious <code>vert.x</code> now note that there are 3 flavours of this dependency:</p><ul><li><a href=https://www.npmjs.com/package/vertx3-min>min</a></li><li><a href=https://www.npmjs.com/package/vertx3-base>base</a></li><li><a href=https://www.npmjs.com/package/vertx3-full>full</a></li></ul><p>According to your needs you can pick a different flavour, since for a simple hello world we only need the minimal that<br>is the one we add to the dependency property.</p><p>Now we need to do a simple hello app, we will call this file “<code>server.js</code>“:</p><pre><code class="hljs javascript"><span class=hljs-comment>// Call the console.log function.</span>
<span class=hljs-built_in>console</span>.log(<span class=hljs-string>"Hello World"</span>);</code></pre><p>You can run this by executing:</p><pre><code class=hljs><span class=hljs-built_in>npm</span> install
<span class=hljs-built_in>npm</span> start</code></pre><p>The first command retrieve the vert.x stack while the seconds starts your program.</p><h2 id=hello-http>Hello HTTP</h2><p>I’d guess that while it’s not the only use case for <code>vert.x</code>, most people are using it as a web application platform. So<br>the next example will be a simple HTTP server that responds to every request with the plain text message “<code>Hello World</code>“<br><code>server.js</code>:</p><pre><code class=hljs><span class=hljs-tag>vertx</span><span class=hljs-class>.createHttpServer</span>()
  <span class=hljs-class>.requestHandler</span>(function (req) {
    <span class=hljs-attribute>req</span>.<span class=hljs-function>response</span>()
      .<span class=hljs-function>putHeader</span>(<span class=hljs-string>"content-type"</span>, <span class=hljs-string>"text/plain"</span>)
      .<span class=hljs-function>end</span>(<span class=hljs-string>"Hello World!"</span>);
})<span class=hljs-class>.listen</span>(<span class=hljs-number>8080</span>);</code></pre><p>Now you can reuse the same <code>package.json</code> we’ve just defined in the previous section and start the server with<br><code>npm start</code>. Once the server starts you can open a browser to <code>http://localhost:8080</code> and enjoy the message.</p><h2 id=hello-tcp>Hello TCP</h2><p><code>Vert.x</code> also makes an excellent TCP server, and here is an example that responds to all TCP connections with the<br>message “Hello World” and then closes the connection <code>server.js</code>:</p><pre><code class=hljs>var server = vertx.createNetServer();
server.connectHandler(function (<span class=hljs-keyword>socket</span>) {
  <span class=hljs-keyword>socket</span>.<span class=hljs-keyword>write</span>(<span class=hljs-string>"Hello World!\n"</span>);
  <span class=hljs-keyword>socket</span>.<span class=hljs-keyword>close</span>();
});

server.<span class=hljs-keyword>listen</span>(<span class=hljs-number>7000</span>, <span class=hljs-string>"localhost"</span>);</code></pre><p>Again reuse the previous <code>package.json</code> and test it by doing <code>telnet localhost 7000</code>.</p><h2 id=hello-web>Hello Web</h2><p>Often you won’t be using <code>vert.x</code> built-in libraries because they are designed to be very low level. This makes <code>vert.x</code><br>quick, nimble, and easy to maintain, but if you are planning to build a complex application you want some productivity<br>and rely on a simple web framework. For this specific case there is <code>vert.x web</code>,<br><a href=http://vertx.io/docs/#web>a simple, yet productive framework</a>, to build fast web application with routing, template<br>rendering, lots of middleware etc…usually not enough to get started on a real world application. This example shows an<br>HTTP server that responds with “Hello World” to all requests to “/“ and responds with a 404 error to everything else<br><code>server.js</code>:</p><pre><code class=hljs><span class=hljs-keyword>var</span> Router = require(<span class=hljs-string>"vertx-web-js/router"</span>);
<span class=hljs-keyword>var</span> server = vertx.createHttpServer();

<span class=hljs-keyword>var</span> router = Router.router(vertx);

router.<span class=hljs-keyword>get</span>(<span class=hljs-string>"/"</span>).handler(<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-params>(ctx)</span> </span>{
  <span class=hljs-comment>// This handler will be called for "/" requests</span>
  <span class=hljs-keyword>var</span> response = ctx.response();
  response.putHeader(<span class=hljs-string>"content-type"</span>, <span class=hljs-string>"text/plain"</span>);

  <span class=hljs-comment>// Write to the response and end it</span>
  response.end(<span class=hljs-string>"Hello World!"</span>);
});

server.requestHandler(router.accept).listen(<span class=hljs-number>8080</span>);</code></pre><p>In order to test this, you will need to install the <code>vertx3-full</code> stack. There are two ways to do this. You can either<br>install it globally <code>npm install -g vertx3-full</code> or add it as a dependency to our <code>package.json</code> as we have done before,<br>for example <code>package.json</code>:</p><pre><code class="hljs javascript">{
  <span class=hljs-string>"name"</span>: <span class=hljs-string>"vertx3-hello-web"</span>,
  <span class=hljs-string>"private"</span>: <span class=hljs-literal>true</span>,
  <span class=hljs-string>"dependencies"</span>: {
    <span class=hljs-string>"vertx3-full"</span>: <span class=hljs-string>"3.0.0-1"</span>
  },
  <span class=hljs-string>"scripts"</span>: {
    <span class=hljs-string>"start"</span>: <span class=hljs-string>"./node_modules/.bin/vertx run server.js"</span>
  }
}</code></pre><p>That’s it for now, Hopefully this will help you get started working with <code>vert.x</code>!</p></article><hr></article><article class=blog-post><h2 class=blog-post-title><a href=/blog/checklist-for-migrating-from-vert-x-2-1-x-to-vert-x-3-part-one/index.html>Checklist for Migrating from Vert.x 2.1.x to Vert.x 3 - Part One</a></h2><p class=blog-post-meta>6th July 2015 by <a href=http://github.com/bytor99999>bytor99999</a></p><article><p>This blog post presents feedbacks from a project migration using Vert.x 2 to Vert.x 3.</p><h2 id=we-are-in-the-process-of-converting-our-vert-x-2-1-5-application-to-vert-x-3-0->We are in the process of converting our Vert.x 2.1.5 application to Vert.x 3.0.</h2><p>So while upgrading our application, I thought I should note down all the changes that we had to do in the process. Since Vert.x 3 is a major upgrade from the previous version, with so many changes.</p><p>It requires re-thinking your current 2.x Vert.x application. There are new classes, new apis, and a new package structure that has greatly simplified things that we used to have to work around. Therefore in our upgrade it required us to refactor and remove any unnecessary <em>“hacks”</em> that weren’t available in 2 that are now a part of Vert.x 3 that you really want and need to take advantage of. (I don’t mean there are hacks in 3.x, just that we had in our application with Vert.x 2.x)</p><p>There are <em>Metrics</em>, and <em>Clustered shared data</em>, with locking and many more features that are amazing new additions. These are things we had to hack into our application with Vert.x 2.x. We added our own <code>MetricsRegistry</code> from <a href="https://dropwizard.github.io/metrics/3.1.0/getting-started/">DropWizard</a> which meant making our own <code>Main</code> class that called Vert.x’s <code>Starter</code> class after starting up the registry, but only in our <em>Devops</em> server deploys, not our developer machines. And we had to build our own distributed locked of clustered data that also required writing a comprehensive distributed timers. (The timers got fixed with a better actor model). But now we can use what Vert.x gives us internally for those use cases.</p><p>This blog post is part one, as I am sure there will be some new changes that we need to do that we haven’t gotten to yet. Which as we go, will post in part two. Also that this post is a work in progress in that whenever you are upgrading and refactoring your code, it doesn’t leave much time for taking detailed notes, or writing beautiful prose. I am a terrible writer even when I can fully concentrate on it. So the first draft will just be a list of my notes. These notes are not in any particular order, but some things like tests you might want to save for last. (Just DON’T delete your tests, tests are very important)</p><p>One of the first things that Vert.x has changed is the whole <em>classloader</em> setup. Read the Vert.x Docs for more information but basically, we have a flat <em>classloader</em> system now. YAY! And one of the first things I noticed that is gone is the <code>Platform</code> module.</p><h2 id=changes-we-have-made->Changes we have made.</h2><h3 id=dependency-changes>Dependency changes</h3><ol><li><p>So the first thing we did was to remove the <code>vert.x-platform</code> dependency from our <code>pom</code> file (Build dependency file of whatever build system you use) This also means that you will be removing any import statements from your code that has <code>.platform</code>. Which leads us to the next point.</p></li><li><p>Change all the imports for Vertx. from <code>org.vertx</code> to <code>io.vertx</code>. This could be a lot of work, as it is in every class you use Vert.x in. We had at least 250 locations to change here. Some classes have moved packages and “jars” that have them, so there will be some new jars to include as dependencies and different import statements for them.</p></li><li><p>If using a language other than Java, change the dependency to <code>vertx-lang-&lt;&lt;language&gt;&gt;</code></p></li><li><p>Remove any modules references that are using Vert.x 2.x stuff. You can get an odd error like<br><em>The type org.vertx.java.core.json.JsonObject cannot be resolved. It is indirectly referenced from required .class files</em>.</p></li><li><p><code>testtools</code> dependency is gone. There is now Vertx-unit. So all your previous tests need to be completely re-written in the new style. This can be really difficult and time consuming as the tests you already have written really do need to be re-written from scratch. But these tests are also the backbone in knowing if your code is working. So this could take months if you have a really full set of test suites already. Also note the list below is to convert your JUnit Integration tests. as vertx-unit first and foremost provides its own testing framework/suite but it also works in JUnit, and if you are using JUnit you need to do the following</p><ul><li>Remove all the imports to <code>TestTools</code>, including <code>VertxAssert</code>. I would do a find/replace to replace all the <code>VertxAssert</code> to <code>testContext</code> for when you have to add <code>TestContext</code> to all your <code>@Test</code> methods. I recommend naming the parameter <code>testContext</code>, just to put more context, into your context. Because if you just have <code>context</code> as your parameter name, how do you know what context the context is? Sorry, that was too much fun. Basically, what I am saying is if you have say <code>Spring ApplicationContext</code> in with your integration tests with Vert.x what does <code>context</code> represent? Spring or Vert.x test context.</li><li>Add <code>@RunWith(VertxUnitRunner.class)</code> above your test class</li><li>Remove any <code>VertxAssert.testComplete()</code> those are gone. It needs <code>TestContext.async().complete()</code>. It is also important to understand what <code>async()</code> means. When to call it, when to complete it. It also allows you to do multiple <code>async()</code> calls and nested ones. I think I needed that when I had a test that was a longer use case of many messages being sent, but only after responses to other ones occurred. For instance, to do chat in our app, you have to connect, subscribe, friend someone, then you can send a chat message. So that is 4 total Vert.x Messages sent from the Test client. And you can subscribe until connect completed, and you can send or receive messages unless you are subscribed and have a friend. So we need to have a few <code>async()</code> calls in that scenario.</li><li>What is in your <code>start</code> method override. Make that an <code>@Before</code>.</li><li>What is in your <code>stop</code> method override. Make that an <code>@After</code>.</li><li>If you have your assertions have custom message <em>strings</em> to log out when they fail, that parameter is now at the end of the <code>assert</code> method call. Yes, this one can be painful.</li></ul></li></ol><h3 id=build-changes>Build Changes</h3><ol><li><p>Remove all <em>vertx maven plugin</em> code to generate modules, instead create <em>fat</em> jars, which requires adding the <em>Shade maven plugin</em> to put all jar files into a big fat jar. The vertx-examples project has <a href=https://github.com/vert-x3/vertx-examples/tree/master/maven-simplest>simplest-maven</a> which has the stuff to create the fat jar. <a href=https://github.com/vert-x3/vertx-examples/tree/master/gradle-simplest>simplest-gradle</a> is the gradle equivalent.</p></li><li><p>If you were running your application with <code>runMod</code> or something like that then you need to create a <em>fat</em> jar, changing the build file as in <a href=https://github.com/vert-x3/vertx-examples/blob/master/maven-simplest/pom.xml>this one</a> and create a Main class like here <a href=https://github.com/vert-x3/vertx-examples/blob/master/maven-simplest/src/main/java/io/vertx/example/HelloWorldEmbedded.java>this one</a>.</p></li></ol><h3 id=class-code-changes>Class/Code Changes</h3><ol><li><p><code>Verticle</code> is now an interface and not a class to extend, so using Groovy as an example you now extend <code>GroovyVerticle</code>. In Java extend <code>AbstractVerticle</code> instead.</p></li><li><p>There is no <code>registerHandler</code> on the eventBus anymore. So everywhere you do that has to change to create/call <code>consumer()</code> and to unregister that handler, you have to have a reference to the <code>MessageConsumer</code> that <code>consumer()</code> call returns and call its <code>unregister</code> method.</p></li><li><p><code>JsonObject.toMap()</code> changed to <code>JsonObject.getMap()</code></p></li><li><p><code>JsonObject</code> also removed all the <code>putXXX</code> methods with just one <code>put</code> method with overloaded versions for different types.</p></li><li><p><code>JsonObjectMessage</code> no longer exists. What replaces depends on what you are doing. Meaning, if it is an <code>async</code> callback to a deploy, you will get a <code>Message</code> instance back that has <code>succeeded()</code> or <code>failed()</code> methods as well as <code>body()</code> to check any results. If it is a <code>Consumer</code>, it is typically a straight forward<br><code>JsonObject</code>. If you are in Groovy it is also a <code>JsonObject</code>, but the <code>body()</code> is a <code>Map</code> which you can use directly now, instead of having to convert from <code>JsonObject</code> to <code>Map</code>.</p></li><li><p>There isn’t a <code>container</code> variable in <code>Verticles</code> anymore for deploying verticles and also a config file. You need to use <code>vertx.getOrCreateContext().config()</code> to get to it. I used that in the SockJS Example code below.</p></li><li><p><code>SharedData</code> no longer has shared sets. It has a <code>Map</code> of <code>SharedData</code>, so an entry in that <code>Map</code> of shared data could be the name of the set as the key, and a <code>Set</code> as the value. It actually gives you more flexibility of what you put into Shared data, so this is actually a big win for us.</p></li><li><p>Getting the <code>writeHandlerID</code> from a Socket type, is now a method call instead of <code>.writeHandlerID</code>, so <code>.writeHandlerID()</code></p></li><li><p><code>SockJSSocket</code> is in <em>vertx-web</em> package now, so include it to get the class.</p></li><li><p>There isn’t a <code>SockJSServer</code> class anymore either. So you will create a <code>WebServer</code>, a <code>Router</code><br>and set SSL (if you are using SSL on the WebServer) then create a <code>SockJSHandler</code> to assign to the router via the <code>route()</code> method and <code>handler()</code> methods in the Router api.<br>Here is an example of our code. Although I haven’t tested it yet. ;)</p></li></ol><pre><code class="hljs groovy"><span class=hljs-keyword>public</span> <span class=hljs-class><span class=hljs-keyword>class</span> <span class=hljs-title>MyVerticle</span> <span class=hljs-keyword>extends</span> <span class=hljs-title>GroovyVerticle</span> {</span>
  Router router

  <span class=hljs-annotation>@Override</span>
  <span class=hljs-typename>void</span> start() <span class=hljs-keyword>throws</span> Exception {
     router = Router.router(vertx)
     (Map&lt;String, Object&gt;) sslConfig =
        (Map&lt;String, Object&gt;)vertx.getOrCreateContext()
          .config().get(<span class=hljs-string>'ssl'</span>)

     HttpServer sslHttpServer = vertx.createHttpServer(
<span class=hljs-label>         SSL:</span> <span class=hljs-literal>true</span>,
<span class=hljs-label>         keyStorePath:</span> sslConfig.get(<span class=hljs-string>"keystore"</span>),
<span class=hljs-label>         keyStorePassword:</span> sslConfig.get(<span class=hljs-string>"password"</span>))

     startWebApiServer(sslHttpServer)
  }

  <span class=hljs-keyword>private</span> <span class=hljs-typename>void</span> startWebApiServer(<span class=hljs-keyword>final</span> HttpServer httpServer) {
    <span class=hljs-keyword>def</span> sockHandler = SockJSHandler.create(vertx, [:])
    sockHandler.socketHandler {
      SockJSSocket ws -&gt; sockJSConnectHandler(ws)
    }
    router.route(<span class=hljs-string>"/hdpoker"</span>).handler(sockHandler)
    httpServer.requestHandler(router.&amp;accept)
    httpServer.listen()
  }

}</code></pre><h4 id=more-testing-change>More testing change</h4><p>Testing messages in Integration Tests. To tell the test method that this has async calls put<br><code>Async async = testContext.async()</code> as the first line in the test method. Yes, this is a little redundant from above, but I always forgot to put <code>async()</code> calls in my integration tests and they would pass so quickly, without sending anything out, because it wasn’t waiting anymore</p><h3 id=runtime-changes>Runtime changes</h3><p>If you don’t use Vert.x built-in Logging and need to use slf4j, then remember that you should set a system property called <code>vertx.logger-delegate-factory-class-name</code> with the name of a Java class which implements the interface <code>LoggerFactory</code>. Vert.x provides pre-built implementations for Log4J and SLF4J with the class names <code>io.vertx.core.logging.Log4jLogDelegateFactory</code> and <code>io.vertx.core.logging.SLF4JLogDelegateFactory</code>.</p><h2 id=still-working>Still working</h2><p>Well, that is all I have for you folks so far. We are still not done, as we haven’t gotten our application running with real clients just yet. But we do have all our integration tests from before completely passing<br>so, if something does come up, it should be a small one (KNOCK ON WOOD)</p><p>Please feel free to post on the Vert.x Google Group with any comments or suggestions on what to add to this blog post or for Part Two.</p><p>Thanks</p><p>Mark S</p></article><hr></article><article class=blog-post><h2 class=blog-post-title><a href=/blog/vert-x3-and-postgresql-json-type/index.html>Vert.x3 and PostgreSQL JSON type</a></h2><p class=blog-post-meta>3rd July 2015 by <a href=http://github.com/pmlopes>pmlopes</a></p><article><p>One of the interesting features of NoSQL databases is their schema-less mode of operation. This feature is very useful<br>during project prototyping and early development since at early the stages of development of projects all data<br>structures are not clear or have been defined yet. The reason of this post is not to discuss about that subject, but to<br>show that sometimes you can also use NoSQL with a more traditional database engine like <a href="http://www.postgresql.org/">PostgreSQL</a>.</p><p>Since version <a href=http://www.postgresql.org/docs/9.3/static/datatype-json.html>9.3</a> there is support for JSON however with<br>version <a href=http://www.postgresql.org/docs/9.4/static/datatype-json.html>9.4</a> there is even better support with the new type<br>JSONB. I will now show how to use the basic JSON type in a simple REST application written with Vert.x3:</p><script src=https://gist.github.com/pmlopes/47f7f02b0b102b5e68d8.js></script><p>Now all you need to do is play with this REST service, for this you can use curl to create a sale:</p><pre><code>$ curl \
    -<span class=ruby>i \
</span>    -<span class=ruby><span class=hljs-constant>H</span> <span class=hljs-string>"Content-Type: application/json"</span> \
</span>    -<span class=ruby><span class=hljs-constant>X</span> <span class=hljs-constant>POST</span> \
</span>    -<span class=ruby>d <span class=hljs-string>'{"id": 1, "customer_name": "John", "items": {"description": "milk", "quantity": 4}}'</span> \
</span>    http://localhost:8080/sales

HTTP/1.1 201 Created
Content-Length: 0
$</code></pre><p>And if you want to read that new document:</p><pre><code>$ curl -i -H <span class=hljs-string>"Accept: application/json"</span> -X GET <span class=hljs-string>http:</span><span class=hljs-comment>//localhost:8080/sales/1</span>
HTTP/<span class=hljs-number>1.1</span> <span class=hljs-number>200</span> OK
content-<span class=hljs-string>type:</span> application/json
Content-<span class=hljs-string>Length:</span> <span class=hljs-number>75</span>

{<span class=hljs-string>"id"</span>:<span class=hljs-number>1</span>,<span class=hljs-string>"customer_name"</span>:<span class=hljs-string>"John"</span>,<span class=hljs-string>"items"</span>:{<span class=hljs-string>"description"</span>:<span class=hljs-string>"milk"</span>,<span class=hljs-string>"quantity"</span>:<span class=hljs-number>4</span>}}
$</code></pre></article><hr></article><article class=blog-post><h2 class=blog-post-title><a href=/blog/vert-x-3-init-d-script/index.html>Vert.x 3 init.d Script</a></h2><p class=blog-post-meta>2nd July 2015 by <a href=http://github.com/cescoffier>cescoffier</a></p><article><p>Let’s say you have a Vert.x 3 application you want to install on a Linux server. But you want the <em>old school</em> way (I meant not the docker way &#9786;). So, in other words, you need an <em>init.d</em> script. This post proposes an <em>init.d</em> script that you can use to start / stop / restart a Vert.x 3 application.</p><h2 id=prerequisites>Prerequisites</h2><p>The proposed script assumes your application is packaged as a <em>fat jar</em>. So, your application is going to be launched using <code>java -jar your-fat-jar ...</code>.</p><h2 id=the-script>The script</h2><p>The <em>init.d</em> scripts have to reply to a set of <em>commands</em>:</p><ul><li><code>start</code> : starts the application (if not yet started)</li><li><code>stop</code> : stops the application (if started)</li><li><code>status</code> : let you know if the application is started or not</li><li><code>restart</code> : restart the application</li></ul><p>These <em>commands</em> are invoked using:</p><pre><code><span class=hljs-keyword>service</span> my-<span class=hljs-keyword>service</span>-script <span class=hljs-literal>start</span>
<span class=hljs-keyword>service</span> my-<span class=hljs-keyword>service</span>-script <span class=hljs-literal>stop</span>
<span class=hljs-keyword>service</span> my-<span class=hljs-keyword>service</span>-script <span class=hljs-literal>status</span>
<span class=hljs-keyword>service</span> my-<span class=hljs-keyword>service</span>-script <span class=hljs-literal>restart</span></code></pre><p>In general, service scripts are hooked in the boot and shutdown sequences to start and stop automatically during the system starts and stops.</p><p>So, enough talks, let’s look at the script:</p><script src=https://gist.github.com/cescoffier/ccc8b391787e93f4e6e0.js></script><h2 id=using-the-script>Using the script</h2><p>First download the script from the <a href=https://gist.githubusercontent.com/cescoffier/ccc8b391787e93f4e6e0/raw/my-vertx-application>here</a>.</p><p>You need to set a couple of variables located at the beginning of the file:</p><pre><code class=hljs><span class=hljs-comment># The directory in which your application is installed</span>
<span class=hljs-variable>APPLICATION_DIR=</span><span class=hljs-string>"/opt/my-vertx-app"</span>
<span class=hljs-comment># The fat jar containing your application</span>
<span class=hljs-variable>APPLICATION_JAR=</span><span class=hljs-string>"maven-verticle-3.0.0-fat.jar"</span>
<span class=hljs-comment># The application argument such as -cluster -cluster-host ...</span>
<span class=hljs-variable>APPLICATION_ARGS=</span><span class=hljs-string>""</span>
<span class=hljs-comment># vert.x options and system properties (-Dfoo=bar).</span>
<span class=hljs-variable>VERTX_OPTS=</span><span class=hljs-string>""</span>
<span class=hljs-comment># The path to the Java command to use to launch the application (must be java 8+)</span>
<span class=hljs-variable>JAVA=</span>/opt/java/java/bin/java</code></pre><p>The rest of the script can stay as it is, but feel free to adapt it to your needs. Once you have set these variables based on your environment, move the file to <code>/etc/init.d</code> and set it as executable:</p><pre><code>sudo mv <span class=hljs-keyword>my</span>-vertx-<span class=hljs-type>application</span> /etc/init.d
sudo chmod +x <span class=hljs-keyword>my</span>-vertx-<span class=hljs-type>application</span></code></pre><p>Then, you should be able to start your application using:</p><pre><code class=hljs>sudo service <span class=hljs-keyword>my</span>-vertx-<span class=hljs-type>application</span> start</code></pre><p>Depending to your operating system, adding the hooks to the boot and shutdown sequence differs. For instance on Ubuntu you need to use the <code>update-rc.d</code> command while on CentOS <code>chkconfig</code> is used</p><p><strong>That’s all, enjoy !</strong></p></article><hr></article><article class=blog-post><h2 class=blog-post-title><a href=/blog/vert-x3-web-easy-as-pi/index.html>Vert.x3 Web easy as Pi</a></h2><p class=blog-post-meta>1st July 2015 by <a href=http://github.com/pmlopes>pmlopes</a></p><article><p><a href=http://vertx.io/docs/#web>Vert.x Web</a> distinguishes itself from traditional application servers like JavaEE by just<br>being a simple extension toolkit to <a href=http://vertx.io/docs/#core>Vert.x</a>, which makes it quite lightweight and small but<br>nevertheless very powerful.</p><p>One can create simple applications targeting <em>small</em> devices such as Raspberry Pi without having to write much code but<br>still very fast as it is expected from any Vert.x application.</p><p>Lets for example think of making a <a href=https://github.com/pmlopes/vert-x3-experiments/archive/experiments/rpi-cpuload.zip>realtime cpu load visualization web app</a>.<br>For this example we need a few things:</p><ul><li>a <a href=http://docs.oracle.com/javase/7/docs/api/java/lang/management/OperatingSystemMXBean.html>MXBean</a> to collect CPU load</li><li>a <a href=http://vertx.io/docs/vertx-core/java/#_writing_http_servers_and_clients>HTTP server</a> (to serve the static resources and host our app)</li><li>a <a href=http://vertx.io/docs/vertx-web/java/#_sockjs>SockJS server</a> to provide realtime updates</li><li>a SockJS to <a href=http://vertx.io/docs/vertx-web/java/#_sockjs_event_bus_bridge>EventBus bridge</a> to pass messages around</li><li>some <a href="http://d3js.org/">visualization</a> JS library</li><li>a bit of coding</li></ul><p>To bootstrap this project we start by creating the <a href=https://github.com/pmlopes/vert-x3-experiments/blob/experiments/rpi-cpuload/pom.xml>pom.xml</a><br>file. A good start is always to consult the <a href=https://github.com/vert-x3/vertx-examples>examples</a>,<br>and you should end up with something like:</p><pre><code class="hljs xml">...
<span class=hljs-tag>&lt;<span class=hljs-title>groupId</span>&gt;</span>io.vertx.blog<span class=hljs-tag>&lt;/<span class=hljs-title>groupId</span>&gt;</span>
<span class=hljs-tag>&lt;<span class=hljs-title>artifactId</span>&gt;</span>rpi<span class=hljs-tag>&lt;/<span class=hljs-title>artifactId</span>&gt;</span>
<span class=hljs-tag>&lt;<span class=hljs-title>version</span>&gt;</span>1.0<span class=hljs-tag>&lt;/<span class=hljs-title>version</span>&gt;</span>

<span class=hljs-tag>&lt;<span class=hljs-title>dependencies</span>&gt;</span>
  <span class=hljs-tag>&lt;<span class=hljs-title>dependency</span>&gt;</span>
    <span class=hljs-tag>&lt;<span class=hljs-title>groupId</span>&gt;</span>io.vertx<span class=hljs-tag>&lt;/<span class=hljs-title>groupId</span>&gt;</span>
    <span class=hljs-tag>&lt;<span class=hljs-title>artifactId</span>&gt;</span>vertx-core<span class=hljs-tag>&lt;/<span class=hljs-title>artifactId</span>&gt;</span>
    <span class=hljs-tag>&lt;<span class=hljs-title>version</span>&gt;</span>3.0.0<span class=hljs-tag>&lt;/<span class=hljs-title>version</span>&gt;</span>
  <span class=hljs-tag>&lt;/<span class=hljs-title>dependency</span>&gt;</span>

  <span class=hljs-tag>&lt;<span class=hljs-title>dependency</span>&gt;</span>
    <span class=hljs-tag>&lt;<span class=hljs-title>groupId</span>&gt;</span>io.vertx<span class=hljs-tag>&lt;/<span class=hljs-title>groupId</span>&gt;</span>
    <span class=hljs-tag>&lt;<span class=hljs-title>artifactId</span>&gt;</span>vertx-web<span class=hljs-tag>&lt;/<span class=hljs-title>artifactId</span>&gt;</span>
    <span class=hljs-tag>&lt;<span class=hljs-title>version</span>&gt;</span>3.0.0<span class=hljs-tag>&lt;/<span class=hljs-title>version</span>&gt;</span>
  <span class=hljs-tag>&lt;/<span class=hljs-title>dependency</span>&gt;</span>
<span class=hljs-tag>&lt;/<span class=hljs-title>dependencies</span>&gt;</span>
...</code></pre><p>At this moment you can start coding the application using the standard maven source <code>src/main/java</code> and resource<br><code>src/main/resouces</code> locations. And add a the class <a href=https://github.com/pmlopes/vert-x3-experiments/blob/experiments/rpi-cpuload/src/main/java/io/vertx/blog/RPiVerticle.java>io.vertx.blog.RpiVerticle</a><br>to the project:</p><pre><code class="hljs java"><span class=hljs-keyword>public</span> <span class=hljs-class><span class=hljs-keyword>class</span> <span class=hljs-title>RPiVerticle</span> <span class=hljs-keyword>extends</span> <span class=hljs-title>AbstractVerticle</span> </span>{

  <span class=hljs-keyword>private</span> <span class=hljs-keyword>static</span> <span class=hljs-keyword>final</span> OperatingSystemMXBean osMBean;

  <span class=hljs-keyword>static</span> {
    <span class=hljs-keyword>try</span> {
      osMBean = ManagementFactory.newPlatformMXBeanProxy(ManagementFactory.getPlatformMBeanServer(),
          ManagementFactory.OPERATING_SYSTEM_MXBEAN_NAME, OperatingSystemMXBean.class);
    } <span class=hljs-keyword>catch</span> (IOException e) {
      <span class=hljs-keyword>throw</span> <span class=hljs-keyword>new</span> RuntimeException(e);
    }
  }

  <span class=hljs-annotation>@Override</span>
  <span class=hljs-function><span class=hljs-keyword>public</span> <span class=hljs-keyword>void</span> <span class=hljs-title>start</span><span class=hljs-params>()</span> </span>{

    Router router = Router.router(vertx);

    router.route(<span class=hljs-string>"/eventbus/*"</span>).handler(SockJSHandler.create(vertx)
        .bridge(<span class=hljs-keyword>new</span> BridgeOptions().addOutboundPermitted(<span class=hljs-keyword>new</span> PermittedOptions().setAddress(<span class=hljs-string>"load"</span>))));

    router.route().handler(StaticHandler.create());

    vertx.createHttpServer().requestHandler(router::accept).listen(<span class=hljs-number>8080</span>);

    vertx.setPeriodic(<span class=hljs-number>1000</span>, t -&gt; vertx.eventBus().publish(<span class=hljs-string>"load"</span>,
        <span class=hljs-keyword>new</span> JsonObject()
            .put(<span class=hljs-string>"creatTime"</span>, System.currentTimeMillis())
            .put(<span class=hljs-string>"cpuTime"</span>, osMBean.getSystemLoadAverage())));
  }
}</code></pre><p>So lets go through the code, first in the static constructor we initialize the <code>MXBean</code> that will allow us to collect<br>the current <code>System Load Average</code>, then on the <code>start</code> method we create a <code>Vert.x Web Router</code> and define that for all<br>requests starting with <code>/eventbus</code> should be handled by the SockJS server, which we then bridge to the Vert.x<br><code>EventBus</code> and allow outbound messages addressed to the <code>load</code> address.</p><p>Since our application is a web application we will also server some static content with the <code>StaticHandler</code> and we<br>finally start a <code>HTTP server</code> listening on port <code>8080</code>.</p><p>So now all we are missing is a way to push real time data to the client so we end up creating a <code>Periodic</code> task that<br>repeats every 1000 milliseconds and sends some <code>JSON</code> payload to the address <code>&quot;load&quot;</code>.</p><p>If you run this application right now you won’t see much since there is no frontend yet, so lets build a very basic<br><a href=https://github.com/pmlopes/vert-x3-experiments/blob/experiments/rpi-cpuload/src/main/resources/webroot/index.html>index.html</a>:</p><pre><code class="hljs javascript">...
<span class=hljs-keyword>var</span> eb = <span class=hljs-keyword>new</span> vertx.EventBus(<span class=hljs-built_in>window</span>.location + <span class=hljs-string>"eventbus"</span>);

eb.onopen = <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-params>()</span> </span>{
  eb.registerHandler(<span class=hljs-string>"load"</span>, <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-params>(msg)</span> </span>{
    <span class=hljs-keyword>if</span> (data.length === <span class=hljs-number>25</span>) {
      <span class=hljs-comment>// when length of data equal 25 then pop data[0]</span>
      data.shift();
    }
    data.push({
      <span class=hljs-string>"creatTime"</span>: <span class=hljs-keyword>new</span> <span class=hljs-built_in>Date</span>(msg.creatTime),
      <span class=hljs-string>"cpuTime"</span>: msg.cpuTime
    });
    render();
  });
};
...</code></pre><p>Lets walk again the code, we start by opening a <code>EventBus</code> bridge over <code>SockJS</code> and register a handler <code>data</code> to consume<br>messages sent to that address. Once such a message arrives we do some house keeping to avoid filling our browser memory<br>and then add the incoming message to the data queue and triger a rendering of the data. There is however one interesting<br>issue here, since the message payload is <code>JSON</code> there is no native support for <code>Date</code> objects so we need to do some<br>parsing from what arrives from the server. In this case the server sends a simple time since epoch number, but one can<br>choose any format he likes.</p><p>At this moment you can build and package your app like <code>mvn clean package</code>, then deploy it to your raspberrypi like:<br><code>scp target/rpi-1.0-fat.jar pi@raspberrypi:~/</code> and finally run it: <code>java -jar rpi-1.0-fat.jar</code>.</p><p>Open a browser to <a href=http://raspberrypi:8080>see</a> the realtime graph!</p><p><img src=/assets/blog/vertx3-web-easy-as-pi/rpi.png alt=screeshot></p></article><hr></article><article class=blog-post><h2 class=blog-post-title><a href=/blog/vert-x-2-1-6-released/index.html>Vert.x 2.1.6 released !</a></h2><p class=blog-post-meta>30th June 2015 by <a href=http://github.com/cescoffier>cescoffier</a></p><article><p>The Vert.x team is pleased to announce the release of Vert.x <strong>2.1.6</strong>.</p><p>This is a maintenance release on the 2.x branch that fixes a few bugs and is designed for Vert.x 2 production users who cannot upgrade to 3.0 immediately.</p><p>For the latest production version for new projects please see <a href=http://vertx.io>Vert.x 3.0</a>.</p><p>Fixes in this release include:</p><ul><li><em>runZip</em> - fix bugs in unpacking zips</li><li><em>HttpClient</em> - make sure writeHead is set to true before connect</li><li>Upgrade to Hazelcast 3.5 to fix bug in <code>Multimap</code> state.</li><li>Workaround for Hazelcast bug which could result in inconsistent cluster state if multiple nodes shutdown concurrently</li><li>Clustering fixes related to clearing up state in case of event bus connections closing and on close of event bus.</li><li>Fix message replies to nodes other than the node the SockJS bridge is deployed on.</li></ul><p>The artifacts has been deployed to <a href=http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22io.vertx%22%20AND%20v%3A%222.1.6%22>Maven Central</a>, and you can get the distribution on <a href=https://bintray.com/vertx/downloads/distribution/2.1.6/view>Bintray</a>.</p></article><hr></article><nav class=pagination><a href=http://vertx.io/blog/page-3.html class=pagination__link--older>&lt; Older</a> <a href=http://vertx.io/blog/blog.html class=pagination__link--newer>Newer &gt;</a></nav></div><div class="col-sm-4 blog-sidebar"><div class=blog-contribute><h4>Recent Posts</h4><ul><li><a href=/blog/vert-x3-real-time-web-apps/index.html>Vert.x3 real time web apps</a></li><li><a href=/blog/unit-and-integration-tests/index.html>Unit and Integration Tests</a></li><li><a href=/blog/some-rest-with-vert-x/index.html>Some Rest with Vert.x</a></li><li><a href=/blog/vert-x-application-configuration/index.html>Vert.x Application Configuration</a></li><li><a href=/blog/my-first-vert-x-3-application/index.html>My first Vert.x 3 Application</a></li><li><a href=/blog/vert-x3-says-hello-to-npm-users/index.html>Vert.x3 says &quot;hello&quot; to NPM users</a></li></ul><hr><p>Have something interesting to say about Vert.x? Want to contribute to this blog? Just check the <a href=https://github.com/vert-x3/vertx-web-site/blob/web-site-3.0.0/BLOG.md>instructions</a>.</p><p></p></div></div></div></div><footer><div class=container><div class=row><div class="col-xs-6 col-sm-3 col-md-3 col-lg-2"><h2>Vert.x</h2><ul class=list-unstyled><li><a href="http://vertx.io/">Home</a></li><li><a href=https://bintray.com/vertx/downloads/distribution/view>Download</a></li><li><a href="http://vertx.io/docs/">Documentation</a></li><li><a href=https://github.com/vert-x3/wiki/wiki>Wiki</a></li><li><a href="http://vertx.io/vertx2/" class=vertx-2-link>Vert.x 2</a></li></ul></div><div class="col-xs-6 col-sm-3 col-md-3 col-lg-2"><h2>Community</h2><ul class=list-unstyled><li><a href="http://vertx.io/community/">Help &amp; Contributors</a></li><li><a href=https://groups.google.com/forum/?fromgroups#!forum/vertx>User Group</a></li><li><a href=https://groups.google.com/forum/?fromgroups#!forum/vertx-dev>Developer Group</a></li></ul></div><div class="col-xs-12 col-sm-6 col-lg-offset-2 col-md-6 copyright"><p>Vert.x is open source and dual licensed under the <a href=https://www.eclipse.org/org/documents/epl-v10.php>Eclipse Public License 1.0</a> and <a href=https://www.apache.org/licenses/LICENSE-2.0.html>Apache License 2.0</a>.</p><p>This website is licensed under the <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0 License</a>.<br>Design by <a href=http://www.michel-kraemer.com>Michel Kr&auml;mer</a>. <a href=http://www.entypo.com>Entypo pictograms</a> by Daniel Bruce.</p><div class=row><div class="col-xs-12 col-lg-offset-2 col-md-5"><img class="logo eclipse-logo" src=http://vertx.io/assets/eclipse_logo_grey_small.png width=204 height=48></div><div class="col-xs-12 col-md-offset-2 col-lg-offset-0 col-md-5"><img class="logo cloudbees-logo" src=http://vertx.io/assets/Button-Built-on-CB-1-grey.png width=184 height=48></div></div></div></div></div></footer><script src=http://static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js></script><script src=http://vertx.io/javascripts/bootstrap.min.js></script><script src=http://vertx.io/javascripts/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>