<!DOCTYPE html><html lang=en><head><title>Blog</title><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta content="width=device-width,initial-scale=1" name=viewport><meta content="Vert.x is a tool-kit for building reactive applications on the JVM." name=description><link href=http://vertx.io/stylesheets/main.css media=screen rel=stylesheet><link href=http://vertx.io/stylesheets/font-awesome.min.css media=screen rel=stylesheet><link href=http://vertx.io/javascripts/styles/rainbow.min.css media=screen rel=stylesheet><!--[if lt IE 9]><script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script><![endif]--><link href=http://vertx.io/assets/favicons/vertx-favicon-5.ico rel="shortcut icon"><link href="http://fonts.googleapis.com/css?family=Ubuntu:400,500,700,400italic" rel=stylesheet type=text/css><link rel=alternate type=application/rss+xml title=RSS href=http://vertx.io/feed.xml><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-30144458-1', 'auto');
    ga('send', 'pageview');</script></head><body><a href="http://www.reactivemanifesto.org/" id=reactive-manifesto-banner><img style="border: 0; position: fixed; right: 0; top:0; z-index: 9000" src=http://d379ifj7s9wntv.cloudfront.net/reactivemanifesto/images/ribbons/we-are-reactive-black-right.png></a> <a id=skippy class="sr-only sr-only-focusable" href=#content><div class=container><span class=skiplink-text>Skip to main content</span></div></a><header class="navbar navbar-default navbar-static-top" id=top role=banner><div class=container><div class=navbar-header><button class="navbar-toggle collapsed" type=button data-toggle=collapse data-target=#vertx-navbar-collapse><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="http://vertx.io/" class=navbar-brand><img alt=Brand src=http://vertx.io/assets/logo-sm.png></a></div><nav class="collapse navbar-collapse" id=vertx-navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=https://bintray.com/vertx/downloads/distribution/3.1.0/view>Download</a></li><li><a href="http://vertx.io/docs/">Documentation</a></li><li><a href=https://github.com/vert-x3/wiki/wiki>Wiki</a></li><li><a href="http://vertx.io/community/">Community</a></li><li><a href="http://vertx.io/blog/">Blog</a></li><li><a href="http://vertx.io/vertx2/" class=vertx-2-link>Vert.x 2</a></li></ul></nav></div></header><div class=container><div class="row blog"><div class="col-sm-8 blog-main"><article class=blog-post><h2 class=blog-post-title><a href="http://vertx.io/blog/vert-x-3-init-d-script/">Vert.x 3 init.d Script</a></h2><p class=blog-post-meta>2nd July 2015 by <a href=http://github.com/cescoffier>cescoffier</a></p><article><p>Let’s say you have a Vert.x 3 application you want to install on a Linux server. But you want the <em>old school</em> way (I mean not the Docker way &#9786;). So, in other words, you need an <em>init.d</em> script. This post proposes an <em>init.d</em> script that you can use to start/stop/restart a Vert.x 3 application.</p><h2 id=prerequisites>Prerequisites</h2><p>The proposed script assumes your application is packaged as a <em>fat jar</em>. So, your application is going to be launched using <code>java -jar your-fat-jar ...</code>.</p><h2 id=the-script>The script</h2><p>The <em>init.d</em> scripts have to reply to a set of <em>commands</em>:</p><ul><li><code>start</code> : starts the application (if not yet started)</li><li><code>stop</code> : stops the application (if started)</li><li><code>status</code> : let you know if the application is started or not</li><li><code>restart</code> : restart the application</li></ul><p>These <em>commands</em> are invoked using:</p><pre><code class="hljs bash">service my-service-script start
service my-service-script stop
service my-service-script status
service my-service-script restart</code></pre><p>In general, service scripts are hooked in the boot and shutdown sequences to start and stop automatically during the system starts and stops.</p><p>So, enough talks, let’s look at the script:</p><script src=https://gist.github.com/cescoffier/ccc8b391787e93f4e6e0.js></script><h2 id=using-the-script>Using the script</h2><p>First download the script from the <a href=https://gist.githubusercontent.com/cescoffier/ccc8b391787e93f4e6e0/raw/my-vertx-application>here</a>.</p><p>You need to set a couple of variables located at the beginning of the file:</p><pre><code class=hljs><span class=hljs-comment># The directory in which your application is installed</span>
<span class=hljs-variable>APPLICATION_DIR=</span><span class=hljs-string>"/opt/my-vertx-app"</span>
<span class=hljs-comment># The fat jar containing your application</span>
<span class=hljs-variable>APPLICATION_JAR=</span><span class=hljs-string>"maven-verticle-3.0.0-fat.jar"</span>
<span class=hljs-comment># The application argument such as -cluster -cluster-host ...</span>
<span class=hljs-variable>APPLICATION_ARGS=</span><span class=hljs-string>""</span>
<span class=hljs-comment># vert.x options and system properties (-Dfoo=bar).</span>
<span class=hljs-variable>VERTX_OPTS=</span><span class=hljs-string>""</span>
<span class=hljs-comment># The path to the Java command to use to launch the application (must be java 8+)</span>
<span class=hljs-variable>JAVA=</span>/opt/java/java/bin/java</code></pre><p>The rest of the script can stay as it is, but feel free to adapt it to your needs. Once you have set these variables based on your environment, move the file to <code>/etc/init.d</code> and set it as executable:</p><pre><code class="hljs bash"><span class=hljs-built_in>sudo</span> mv my-vertx-application /etc/init.d
<span class=hljs-built_in>sudo</span> chmod +x my-vertx-application</code></pre><p>Then, you should be able to start your application using:</p><pre><code class="hljs bash"><span class=hljs-built_in>sudo</span> service my-vertx-application start</code></pre><p>Depending to your operating system, adding the hooks to the boot and shutdown sequence differs. For instance on Ubuntu you need to use the <code>update-rc.d</code> command while on CentOS <code>chkconfig</code> is used</p><p><strong>That’s all, enjoy !</strong></p></article><hr></article><article class=blog-post><h2 class=blog-post-title><a href="http://vertx.io/blog/vert-x3-web-easy-as-pi/">Vert.x3 Web easy as Pi</a></h2><p class=blog-post-meta>1st July 2015 by <a href=http://github.com/pmlopes>pmlopes</a></p><article><p><a href=http://vertx.io/docs/#web>Vert.x Web</a> distinguishes itself from traditional application servers like JavaEE by just being a simple extension toolkit to <a href=http://vertx.io/docs/#core>Vert.x</a>, which makes it quite lightweight and small but nevertheless very powerful.</p><p>One can create simple applications targeting <em>small</em> devices such as Raspberry Pi without having to write much code but still very fast as it is expected from any Vert.x application.</p><p>Let’s for example think of making a <a href=https://github.com/pmlopes/vert-x3-experiments/archive/experiments/rpi-cpuload.zip>realtime cpu load visualization web app</a>. For this example we need a few things:</p><ul><li>a <a href=http://docs.oracle.com/javase/7/docs/api/java/lang/management/OperatingSystemMXBean.html>MXBean</a> to collect CPU load</li><li>a <a href=http://vertx.io/docs/vertx-core/java/#_writing_http_servers_and_clients>HTTP server</a> (to serve the static resources and host our app)</li><li>a <a href=http://vertx.io/docs/vertx-web/java/#_sockjs>SockJS server</a> to provide realtime updates</li><li>a SockJS to <a href=http://vertx.io/docs/vertx-web/java/#_sockjs_event_bus_bridge>EventBus bridge</a> to pass messages around</li><li>some <a href="http://d3js.org/">visualization</a> JS library</li><li>a bit of coding</li></ul><p>To bootstrap this project we start by creating the <a href=https://github.com/pmlopes/vert-x3-experiments/blob/experiments/rpi-cpuload/pom.xml>pom.xml</a> file. A good start is always to consult the <a href=https://github.com/vert-x3/vertx-examples>examples</a>, and you should end up with something like:</p><pre><code class="hljs xml">...
<span class=hljs-tag>&lt;<span class=hljs-title>groupId</span>&gt;</span>io.vertx.blog<span class=hljs-tag>&lt;/<span class=hljs-title>groupId</span>&gt;</span>
<span class=hljs-tag>&lt;<span class=hljs-title>artifactId</span>&gt;</span>rpi<span class=hljs-tag>&lt;/<span class=hljs-title>artifactId</span>&gt;</span>
<span class=hljs-tag>&lt;<span class=hljs-title>version</span>&gt;</span>1.0<span class=hljs-tag>&lt;/<span class=hljs-title>version</span>&gt;</span>

<span class=hljs-tag>&lt;<span class=hljs-title>dependencies</span>&gt;</span>
  <span class=hljs-tag>&lt;<span class=hljs-title>dependency</span>&gt;</span>
    <span class=hljs-tag>&lt;<span class=hljs-title>groupId</span>&gt;</span>io.vertx<span class=hljs-tag>&lt;/<span class=hljs-title>groupId</span>&gt;</span>
    <span class=hljs-tag>&lt;<span class=hljs-title>artifactId</span>&gt;</span>vertx-core<span class=hljs-tag>&lt;/<span class=hljs-title>artifactId</span>&gt;</span>
    <span class=hljs-tag>&lt;<span class=hljs-title>version</span>&gt;</span>3.0.0<span class=hljs-tag>&lt;/<span class=hljs-title>version</span>&gt;</span>
  <span class=hljs-tag>&lt;/<span class=hljs-title>dependency</span>&gt;</span>

  <span class=hljs-tag>&lt;<span class=hljs-title>dependency</span>&gt;</span>
    <span class=hljs-tag>&lt;<span class=hljs-title>groupId</span>&gt;</span>io.vertx<span class=hljs-tag>&lt;/<span class=hljs-title>groupId</span>&gt;</span>
    <span class=hljs-tag>&lt;<span class=hljs-title>artifactId</span>&gt;</span>vertx-web<span class=hljs-tag>&lt;/<span class=hljs-title>artifactId</span>&gt;</span>
    <span class=hljs-tag>&lt;<span class=hljs-title>version</span>&gt;</span>3.0.0<span class=hljs-tag>&lt;/<span class=hljs-title>version</span>&gt;</span>
  <span class=hljs-tag>&lt;/<span class=hljs-title>dependency</span>&gt;</span>
<span class=hljs-tag>&lt;/<span class=hljs-title>dependencies</span>&gt;</span>
...</code></pre><p>At this moment you can start coding the application using the standard maven source <code>src/main/java</code> and resource <code>src/main/resouces</code> locations. And add a the class <a href=https://github.com/pmlopes/vert-x3-experiments/blob/experiments/rpi-cpuload/src/main/java/io/vertx/blog/RPiVerticle.java>io.vertx.blog.RpiVerticle</a> to the project:</p><pre><code class="hljs java"><span class=hljs-keyword>public</span> <span class=hljs-class><span class=hljs-keyword>class</span> <span class=hljs-title>RPiVerticle</span> <span class=hljs-keyword>extends</span> <span class=hljs-title>AbstractVerticle</span> </span>{

  <span class=hljs-keyword>private</span> <span class=hljs-keyword>static</span> <span class=hljs-keyword>final</span> OperatingSystemMXBean osMBean;

  <span class=hljs-keyword>static</span> {
    <span class=hljs-keyword>try</span> {
      osMBean = ManagementFactory.newPlatformMXBeanProxy(ManagementFactory.getPlatformMBeanServer(),
          ManagementFactory.OPERATING_SYSTEM_MXBEAN_NAME, OperatingSystemMXBean.class);
    } <span class=hljs-keyword>catch</span> (IOException e) {
      <span class=hljs-keyword>throw</span> <span class=hljs-keyword>new</span> RuntimeException(e);
    }
  }

  <span class=hljs-annotation>@Override</span>
  <span class=hljs-function><span class=hljs-keyword>public</span> <span class=hljs-keyword>void</span> <span class=hljs-title>start</span><span class=hljs-params>()</span> </span>{

    Router router = Router.router(vertx);

    router.route(<span class=hljs-string>"/eventbus/*"</span>).handler(SockJSHandler.create(vertx)
        .bridge(<span class=hljs-keyword>new</span> BridgeOptions().addOutboundPermitted(<span class=hljs-keyword>new</span> PermittedOptions().setAddress(<span class=hljs-string>"load"</span>))));

    router.route().handler(StaticHandler.create());

    vertx.createHttpServer().requestHandler(router::accept).listen(<span class=hljs-number>8080</span>);

    vertx.setPeriodic(<span class=hljs-number>1000</span>, t -&gt; vertx.eventBus().publish(<span class=hljs-string>"load"</span>,
        <span class=hljs-keyword>new</span> JsonObject()
            .put(<span class=hljs-string>"creatTime"</span>, System.currentTimeMillis())
            .put(<span class=hljs-string>"cpuTime"</span>, osMBean.getSystemLoadAverage())));
  }
}</code></pre><p>So let’s go through the code, first in the static constructor we initialize the <code>MXBean</code> that will allow us to collect the current <code>System Load Average</code>, then on the <code>start</code> method we create a <code>Vert.x Web Router</code> and define that for all requests starting with <code>/eventbus</code> should be handled by the SockJS server, which we then bridge to the Vert.x <code>EventBus</code> and allow outbound messages addressed to the <code>load</code> address.</p><p>Since our application is a web application we will also server some static content with the <code>StaticHandler</code> and we finally start a <code>HTTP server</code> listening on port <code>8080</code>.</p><p>So now all we are missing is a way to push real time data to the client so we end up creating a <code>Periodic</code> task that repeats every 1000 milliseconds and sends some <code>JSON</code> payload to the address <code>&quot;load&quot;</code>.</p><p>If you run this application right now you won’t see much since there is no frontend yet, so let’s build a very basic <a href=https://github.com/pmlopes/vert-x3-experiments/blob/experiments/rpi-cpuload/src/main/resources/webroot/index.html>index.html</a>:</p><pre><code class="hljs javascript">...
<span class=hljs-keyword>var</span> eb = <span class=hljs-keyword>new</span> vertx.EventBus(<span class=hljs-built_in>window</span>.location + <span class=hljs-string>"eventbus"</span>);

eb.onopen = <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-params>()</span> </span>{
  eb.registerHandler(<span class=hljs-string>"load"</span>, <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-params>(msg)</span> </span>{
    <span class=hljs-keyword>if</span> (data.length === <span class=hljs-number>25</span>) {
      <span class=hljs-comment>// when length of data equal 25 then pop data[0]</span>
      data.shift();
    }
    data.push({
      <span class=hljs-string>"creatTime"</span>: <span class=hljs-keyword>new</span> <span class=hljs-built_in>Date</span>(msg.creatTime),
      <span class=hljs-string>"cpuTime"</span>: msg.cpuTime
    });
    render();
  });
};
...</code></pre><p>Let’s walk again the code, we start by opening a <code>EventBus</code> bridge over <code>SockJS</code> and register a handler <code>data</code> to consume messages sent to that address. Once such a message arrives we do some house keeping to avoid filling our browser memory and then add the incoming message to the data queue and triger a rendering of the data. There is however one interesting issue here, since the message payload is <code>JSON</code> there is no native support for <code>Date</code> objects so we need to do some parsing from what arrives from the server. In this case the server sends a simple time since epoch number, but one can choose any format he likes.</p><p>At this moment you can build and package your app like <code>mvn clean package</code>, then deploy it to your raspberrypi like: <code>scp target/rpi-1.0-fat.jar pi@raspberrypi:~/</code> and finally run it: <code>java -jar rpi-1.0-fat.jar</code>.</p><p>Open a browser to <a href=http://raspberrypi:8080>see</a> the realtime graph!</p><p><img src=http://vertx.io/assets/blog/vertx3-web-easy-as-pi/rpi.png alt=Screenshot class=img-responsive></p></article><hr></article><article class=blog-post><h2 class=blog-post-title><a href="http://vertx.io/blog/vert-x-2-1-6-released/">Vert.x 2.1.6 released !</a></h2><p class=blog-post-meta>30th June 2015 by <a href=http://github.com/cescoffier>cescoffier</a></p><article><p>The Vert.x team is pleased to announce the release of Vert.x <strong>2.1.6</strong>.</p><p>This is a maintenance release on the 2.x branch that fixes a few bugs and is designed for Vert.x 2 production users who cannot upgrade to 3.0 immediately.</p><p>For the latest production version for new projects please see <a href=http://vertx.io>Vert.x 3.0</a>.</p><p>Fixes in this release include:</p><ul><li><em>runZip</em> - fix bugs in unpacking zips</li><li><em>HttpClient</em> - make sure writeHead is set to true before connect</li><li>Upgrade to Hazelcast 3.5 to fix bug in <code>Multimap</code> state.</li><li>Workaround for Hazelcast bug which could result in inconsistent cluster state if multiple nodes shutdown concurrently</li><li>Clustering fixes related to clearing up state in case of event bus connections closing and on close of event bus.</li><li>Fix message replies to nodes other than the node the SockJS bridge is deployed on.</li></ul><p>The artifacts has been deployed to <a href=http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22io.vertx%22%20AND%20v%3A%222.1.6%22>Maven Central</a>, and you can get the distribution on <a href=https://bintray.com/vertx/downloads/distribution/2.1.6/view>Bintray</a>.</p></article><hr></article><nav class=pagination><a href=http://vertx.io/blog/page-2.html class=pagination__link--newer>Newer &gt;</a></nav></div><div class="col-sm-4 blog-sidebar"><div class=blog-contribute><h4>Recent Posts</h4><ul><li><a href="/blog/contract-driven-rest-services-with-vert-x3/">Contract Driven REST Services with Vert.x3</a></li><li><a href="/blog/writing-secure-vert-x-web-apps/">Writing secure Vert.x Web apps</a></li><li><a href="/blog/vert-x3-real-time-web-apps/">Vert.x3 real time web apps</a></li><li><a href="/blog/unit-and-integration-tests/">Unit and Integration Tests</a></li><li><a href="/blog/some-rest-with-vert-x/">Some Rest with Vert.x</a></li><li><a href="/blog/vert-x-application-configuration/">Vert.x Application Configuration</a></li></ul><hr><p>Have something interesting to say about Vert.x? Want to contribute to this blog? Just check the <a href=https://github.com/vert-x3/vertx-web-site/blob/web-site-3.0.0/BLOG.md>instructions</a>.</p><p></p></div></div></div></div><footer><div class=container><div class=row><div class="col-xs-6 col-sm-3 col-md-3 col-lg-2"><h2>Vert.x</h2><ul class=list-unstyled><li><a href="http://vertx.io/">Home</a></li><li><a href=https://bintray.com/vertx/downloads/distribution/3.1.0/view>Download</a></li><li><a href="http://vertx.io/docs/">Documentation</a></li><li><a href=https://github.com/vert-x3/wiki/wiki>Wiki</a></li><li><a href="http://vertx.io/blog/">Blog</a></li><li><a href="http://vertx.io/vertx2/" class=vertx-2-link>Vert.x 2</a></li></ul></div><div class="col-xs-6 col-sm-3 col-md-3 col-lg-2"><h2>Community</h2><ul class=list-unstyled><li><a href="http://vertx.io/community/">Help &amp; Contributors</a></li><li><a href=https://groups.google.com/forum/?fromgroups#!forum/vertx>User Group</a></li><li><a href=https://groups.google.com/forum/?fromgroups#!forum/vertx-dev>Developer Group</a></li></ul></div><div class="col-xs-12 col-sm-6 col-lg-offset-2 col-md-6 copyright"><p>Vert.x is open source and dual licensed under the <a href=https://www.eclipse.org/org/documents/epl-v10.php>Eclipse Public License 1.0</a> and <a href=https://www.apache.org/licenses/LICENSE-2.0.html>Apache License 2.0</a>.</p><p>This website is licensed under the <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0 License</a>.<br>Design by <a href=http://www.michel-kraemer.com>Michel Kr&auml;mer</a>. <a href=http://www.entypo.com>Entypo pictograms</a> by Daniel Bruce.</p><div class=row><div class="col-xs-12 col-lg-offset-2 col-md-5"><img class="logo eclipse-logo" src=http://vertx.io/assets/eclipse_logo_grey_small.png width=204 height=48></div><div class="col-xs-12 col-md-offset-2 col-lg-offset-0 col-md-5"><img class="logo cloudbees-logo" src=http://vertx.io/assets/Button-Built-on-CB-1-grey.png width=184 height=48></div></div></div></div></div></footer><script src=http://static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js></script><script src=http://vertx.io/javascripts/bootstrap.min.js></script><script src=http://vertx.io/javascripts/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>